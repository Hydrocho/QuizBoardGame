<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>PWA Î™®Î∞îÏùº Î≥¥ÎìúÍ≤åÏûÑ</title>
    <meta name="description" content="ÏπúÍµ¨Îì§Í≥º Ìï®Íªò Ï¶êÍ∏∞Îäî Ïû¨ÎØ∏ÏûàÎäî Î™®Î∞îÏùº Î≥¥ÎìúÍ≤åÏûÑ">
    <meta name="theme-color" content="#4CAF50">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            margin: 0 !important;
            padding: 0 !important;
            width: 100%;
            height: 100%;
        }

        :root {
            --color-start: #FF7F50;
            --color-quiz: #00CED1;
            --color-golden: #FFD700;
            --color-special: #6495ED;
            --color-corner: #4682B4;
            --color-center: #E0F6FF;
            --color-background: #F0F8FF;
            --color-normal: #B0E0E6;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--color-background) 0%, var(--color-normal) 100%);
            min-height: calc(var(--vh, 1vh) * 100);
            overflow: hidden;
        }

        .game-container {
            width: 100vw;
            height: calc(var(--vh, 1vh) * 100);
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* Ï§ëÏïô UI Ìå®ÎÑê */
        .center-panel {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 20px 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            width: calc(85vw * 4.5 / 7);
            max-width: calc(85vw * 4.5 / 7);
            min-width: calc(85vw * 4.5 / 7);
            box-sizing: border-box;
            z-index: 5;
        }


        .players-section {
            display: flex;
            gap: 15px;
            justify-content: center;
            align-items: center;
            width: 100%;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .player-info {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.9);
            padding: 12px 14px;
            border-radius: 15px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            min-width: 150px;
            flex: 1 1 calc(50% - 7.5px);
            max-width: calc(50% - 7.5px);
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .player-info.active {
            border: 2px solid #FFD700;
            animation: playerBlink 1s infinite;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        @keyframes playerBlink {
            0% { 
                border-color: #FFD700;
                box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
            }
            50% { 
                border-color: #FFA500;
                box-shadow: 0 0 15px rgba(255, 165, 0, 0.8);
            }
            100% { 
                border-color: #FFD700;
                box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
            }
        }

        .controls-section {
            display: flex;
            align-items: center;
            gap: 15px;
            justify-content: center;
            width: 100%;
            margin-top: 10px;
        }

        .dice-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .player-avatar {
            width: 45px;
            height: 45px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 18px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            flex-shrink: 0;
        }

        .player-details {
            display: flex;
            flex-direction: column;
            gap: 2px;
            align-items: flex-start;
            flex: 1;
        }

        .player-name {
            font-weight: bold;
            color: #333;
            font-size: 14px;
        }

        .player-score {
            font-size: 12px;
            color: #666;
        }

        .player-lands {
            font-size: 11px;
            color: #888;
        }

        .golden-keys {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
            color: #FFD700;
        }

        .game-status {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .status-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .phase-badge {
            background: rgba(76, 175, 80, 0.9);
            color: white;
        }

        .turn-badge {
            background: rgba(255, 193, 7, 0.9);
            color: #333;
        }

        /* Í≤åÏûÑ Î≥¥Îìú */
        .board-container {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: stretch;
            padding: 2px 5vw;
            overflow: hidden;
            position: relative;
            clip-path: inset(0);
        }

        .game-board {
            width: 85vw;
            height: calc(100% - 4px);
            max-width: 85vw;
            aspect-ratio: 1.4 / 1;
            border: 4px solid var(--color-corner);
            border-radius: 20px;
            background: var(--color-center);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            grid-template-rows: repeat(7, 1fr);
            gap: 0px;
            padding: 0px;
            overflow: hidden;
            clip-path: inset(0);
        }

        .board-space {
            border-radius: 0px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: none;
            min-height: 25px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            box-sizing: border-box;
            overflow: hidden;
            contain: layout;
        }

        .board-space:hover {
            transform: scale(1.02);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }


        /* ÎÇ¥Î∂Ä ÎπàÏπ∏Îì§ÏùÑ ÏúÑÌïú ÌäπÎ≥Ñ Ïä§ÌÉÄÏùº - Î™®Îì† Í∑∏Î¶ºÏûêÏôÄ ÌÖåÎëêÎ¶¨ Ï†úÍ±∞ */
        .board-space.center-background {
            border: none !important;
            box-shadow: none !important;
            outline: none !important;
        }

        .board-space.center-background:hover {
            transform: none !important;
            box-shadow: none !important;
        }

        /* Ï§ëÏïô Î∞∞Í≤Ω Ïπ∏Îì§ - Ìò∏Î≤Ñ Ìö®Í≥º ÎπÑÌôúÏÑ±Ìôî */
        .board-space.center-background {
            cursor: default !important;
            pointer-events: none !important; /* ÎßàÏö∞Ïä§ Ïù¥Î≤§Ìä∏ ÏôÑÏ†Ñ Ï∞®Îã® */
        }

        .board-space.center-background:hover {
            transform: none !important;
            box-shadow: none !important;
            cursor: default !important;
        }

        /* Ï§ëÏïô Ìå®ÎÑêÍ≥º Í≤πÏπòÎäî ÏòÅÏó≠Ïùò Î™®Îì† Ïπ∏Îì§ - Ìò∏Î≤Ñ Ìö®Í≥º ÎπÑÌôúÏÑ±Ìôî */
        .board-space:nth-child(16),  /* (2,2) */
        .board-space:nth-child(17),  /* (2,3) */
        .board-space:nth-child(18),  /* (2,4) */
        .board-space:nth-child(23),  /* (3,2) */
        .board-space:nth-child(24),  /* (3,3) */
        .board-space:nth-child(25),  /* (3,4) */
        .board-space:nth-child(30),  /* (4,2) */
        .board-space:nth-child(31),  /* (4,3) */
        .board-space:nth-child(32) { /* (4,4) */
            cursor: default !important;
        }

        .board-space:nth-child(16):hover,
        .board-space:nth-child(17):hover,
        .board-space:nth-child(18):hover,
        .board-space:nth-child(23):hover,
        .board-space:nth-child(24):hover,
        .board-space:nth-child(25):hover,
        .board-space:nth-child(30):hover,
        .board-space:nth-child(31):hover,
        .board-space:nth-child(32):hover {
            transform: none !important;
            box-shadow: none !important;
            cursor: default !important;
        }

        /* Î™®ÎÖ∏Ìè¥Î¶¨ Ïä§ÌÉÄÏùº ÏßÄÏó≠Î≥Ñ ÏÉâÏÉÅ Îù† */
        .board-space::after {
            content: '';
            position: absolute;
            background: var(--ribbon-color, transparent);
            z-index: 2; /* ÌîåÎ†àÏù¥Ïñ¥ Îßê(z-index: 10)Î≥¥Îã§ ÏïÑÎûò, Ïπ∏ Î∞∞Í≤ΩÎ≥¥Îã§ ÏúÑ */
            transition: background-color 0.3s ease;
        }

        /* 1Î≤à ÌîåÎ†àÏù¥Ïñ¥ ÏßÄÏó≠ (Ïπ∏ 1, 2, 4, 5) - ÏÉÅÎã® Îù† */
        .board-space[data-space="1"]::after,
        .board-space[data-space="2"]::after,
        .board-space[data-space="4"]::after,
        .board-space[data-space="5"]::after {
            top: 0;
            left: 0;
            right: 0;
            height: 18px; /* ÎÜíÏù¥Î•º 2Î∞∞Î°ú Ï¶ùÍ∞Ä */
            border-radius: 9px 9px 0 0;
        }

        /* 2Î≤à ÌîåÎ†àÏù¥Ïñ¥ ÏßÄÏó≠ (Ïπ∏ 7, 8, 10, 11) - Ïò§Î•∏Ï™Ω Îù† */
        .board-space[data-space="7"]::after,
        .board-space[data-space="8"]::after,
        .board-space[data-space="10"]::after,
        .board-space[data-space="11"]::after {
            top: 0;
            right: 0;
            bottom: 0;
            width: 18px; /* ÎÑàÎπÑÎ•º 2Î∞∞Î°ú Ï¶ùÍ∞Ä */
            border-radius: 0 9px 9px 0;
        }

        /* 3Î≤à ÌîåÎ†àÏù¥Ïñ¥ ÏßÄÏó≠ (Ïπ∏ 13, 14, 16, 17) - ÌïòÎã® Îù† */
        .board-space[data-space="13"]::after,
        .board-space[data-space="14"]::after,
        .board-space[data-space="16"]::after,
        .board-space[data-space="17"]::after {
            bottom: 0;
            left: 0;
            right: 0;
            height: 18px; /* ÎÜíÏù¥Î•º 2Î∞∞Î°ú Ï¶ùÍ∞Ä */
            border-radius: 0 0 9px 9px;
        }

        /* 4Î≤à ÌîåÎ†àÏù¥Ïñ¥ ÏßÄÏó≠ (Ïπ∏ 19, 20, 22, 23) - ÏôºÏ™Ω Îù† */
        .board-space[data-space="19"]::after,
        .board-space[data-space="20"]::after,
        .board-space[data-space="22"]::after,
        .board-space[data-space="23"]::after {
            top: 0;
            left: 0;
            bottom: 0;
            width: 18px; /* ÎÑàÎπÑÎ•º 2Î∞∞Î°ú Ï¶ùÍ∞Ä */
            border-radius: 9px 0 0 9px;
        }

        .space-number {
            font-size: clamp(8px, 2vw, 16px);
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        .space-name {
            font-size: clamp(6px, 1.5vw, 12px);
            color: white;
            text-align: center;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
            margin-top: 1px;
            line-height: 1;
        }

        /* Î™®ÎÖ∏Ìè¥Î¶¨ Ïä§ÌÉÄÏùº Î≥¥Îìú Ïπ∏ Î∞∞Ïπò */
        .corner-space {
            background: var(--color-corner) !important;
            color: white;
            font-weight: bold;
            border: 2px solid var(--color-corner) !important;
            font-size: 12px;
        }

        .side-space {
            min-height: 20px;
        }

        .center-space {
            background: var(--color-center) !important;
            color: #000;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            border: 2px solid var(--color-corner);
        }

        .player-piece {
            position: absolute;
            width: 25px;
            height: 25px;
            border-radius: 8px;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: bold;
            transition: all 0.5s ease;
            top: 8%; /* Îù†ÏßÄÏôÄ Í≤πÏπòÏßÄ ÏïäÎèÑÎ°ù ÏúÑÏπò Ï°∞Ï†ï */
            background: rgba(0, 0, 0, 0.2); /* Î∞∞Í≤ΩÏùÑ Ï°∞Í∏à Îçî ÏßÑÌïòÍ≤å ÌïòÏó¨ Í∞ÄÏãúÏÑ± Ìñ•ÏÉÅ */
            z-index: 10; /* Îù†ÏßÄ(z-index: 2)Î≥¥Îã§ ÏúÑÏóê ÌëúÏãú */
        }

        .player-piece.moving {
            animation: bounceMove 0.6s ease-in-out;
            z-index: 20;
        }

        @keyframes bounceMove {
            0% {
                transform: translateY(0px) scale(1);
            }
            25% { 
                transform: translateY(-15px) scale(1.1);
            }
            50% { 
                transform: translateY(0px) scale(1);
            }
            75% { 
                transform: translateY(-8px) scale(1.05);
            }
            100% { 
                transform: translateY(0px) scale(1);
            }
        }

        .player-piece.landing {
            animation: landingBounce 0.4s ease-out;
        }

        @keyframes landingBounce {
            0% {
                transform: translateY(0px) scale(1);
            }
            50% {
                transform: translateY(-10px) scale(1.15);
            }
            100% {
                transform: translateY(0px) scale(1);
            }
        }

        /* Ï†ÑÏ≤¥ÌôîÎ©¥ Î≤ÑÌäº */
        .fullscreen-button {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 45px;
            height: 45px;
            background: rgba(255, 255, 255, 0.98);
            border: 3px solid #333;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 20px;
            color: #333;
            transition: all 0.3s ease;
            z-index: 1000;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
        }

        /* ÏÑ§Ï†ï Î≤ÑÌäº */
        .settings-button {
            position: absolute;
            top: 70px;
            right: 15px;
            width: 45px;
            height: 45px;
            background: rgba(255, 255, 255, 0.98);
            border: 3px solid #333;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 20px;
            color: #333;
            transition: all 0.3s ease;
            z-index: 1000;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
        }

        .fullscreen-button:hover {
            background: rgba(255, 255, 255, 1);
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        /* ÏÑ§Ï†ï Î™®Îã¨ Ïä§ÌÉÄÏùº */
        .settings-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .settings-container {
            background: white;
            border-radius: 8px;
            width: 95%;
            max-width: 900px;
            height: 85%;
            max-height: 650px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            border-bottom: 1px solid #e9ecef;
            background: #f8f9fa;
            border-radius: 8px 8px 0 0;
        }

        .settings-header h2 {
            margin: 0;
            color: #333;
            font-size: 18px;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #666;
            padding: 4px 8px;
            border-radius: 4px;
            transition: background 0.3s ease;
        }

        .close-btn:hover {
            background: #e9ecef;
        }

        .settings-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .settings-sidebar {
            width: 160px;
            background: #f8f9fa;
            border-right: 1px solid #e9ecef;
            padding: 8px 0;
            overflow-y: auto;
        }

        .sidebar-item {
            padding: 8px 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
            font-size: 13px;
        }

        .sidebar-item:hover {
            background: #e3f2fd;
        }

        .sidebar-item.active {
            background: #bbdefb;
            border-left-color: #2196f3;
            font-weight: bold;
        }

        .settings-main {
            flex: 1;
            padding: 12px;
            overflow-y: auto;
        }

        .settings-panel {
            display: none;
        }

        .settings-panel.active {
            display: block;
        }

        .settings-panel h3 {
            margin: 0 0 8px 0;
            color: #333;
            font-size: 16px;
        }

        .setting-group {
            margin: 4px 0;
            padding: 6px;
            background: #f8f9fa;
            border-radius: 6px;
        }

        .setting-group label {
            display: block;
            margin-bottom: 4px;
            font-weight: bold;
            color: #333;
            font-size: 14px;
        }

        .volume-slider {
            width: 100%;
            margin: 6px 0;
        }

        .volume-value {
            color: #666;
            font-size: 14px;
        }

        .palette-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-top: 4px;
        }

        .palette-item {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            border: 2px solid transparent;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            min-height: 32px;
        }

        .palette-item:hover {
            background: #e3f2fd;
        }

        .palette-item.active {
            border-color: #2196f3;
            background: #bbdefb;
        }

        .palette-name {
            font-weight: 500;
            color: #333;
            font-size: 14px;
            line-height: 1.2;
            width: 100%;
        }

        /* ÏÉâÏÉÅ ÏÑ§Ï†ï 2Îã® Î†àÏù¥ÏïÑÏõÉ */
        .color-settings-layout {
            display: flex;
            gap: 12px;
            height: 100%;
        }

        .palette-selection {
            flex: 1;
            min-width: 0;
        }

        .palette-preview {
            flex: 2;
            min-width: 0;
            background: #f8f9fa;
            border-radius: 6px;
            padding: 10px;
            display: flex;
            flex-direction: column;
        }

        .palette-preview h4 {
            margin: 0 0 8px 0;
            color: #333;
            font-size: 14px;
        }

        .mini-board-container {
            background: white;
            border-radius: 6px;
            padding: 8px;
            margin-bottom: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .mini-board {
            width: 200px;
            height: 150px;
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            grid-template-rows: repeat(7, 1fr);
            gap: 1px;
            background: #333;
            border-radius: 6px;
            padding: 2px;
        }

        .mini-space {
            background: #fff;
            border-radius: 2px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 8px;
            font-weight: bold;
            color: #333;
        }

        .palette-info {
            margin-bottom: 15px;
        }

        .palette-info .palette-name {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .palette-info .palette-theme {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
            font-style: italic;
        }

        .palette-colors {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .color-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
        }

        .color-swatch {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }

        .preview-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn-apply, .btn-cancel {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .btn-apply {
            background: #2196f3;
            color: white;
        }

        .btn-apply:hover {
            background: #1976d2;
        }

        .btn-cancel {
            background: #f5f5f5;
            color: #666;
        }

        .btn-cancel:hover {
            background: #e0e0e0;
        }

        /* Î™®Î∞îÏùº Î∞òÏùëÌòï */
        @media (max-width: 768px) {
            .settings-container {
                width: 95%;
                height: 90%;
            }
            
            .settings-content {
                flex-direction: column;
            }
            
            .settings-sidebar {
                width: 100%;
                height: auto;
                max-height: 120px;
                flex-direction: row;
                overflow-x: auto;
                padding: 10px;
                border-right: none;
                border-bottom: 1px solid #e9ecef;
            }
            
            .sidebar-item {
                min-width: 80px;
                text-align: center;
                padding: 10px 5px;
                border-left: none;
                border-bottom: 3px solid transparent;
            }
            
            .sidebar-item.active {
                border-left: none;
                border-bottom-color: #2196f3;
            }
            
            
            .color-settings-layout {
                flex-direction: column;
            }
            
            .palette-preview {
                width: 100%;
                min-width: auto;
            }
            
            .mini-board {
                width: 150px;
                height: 120px;
            }
        }

        .fullscreen-button:active {
            transform: scale(0.95);
        }

        .settings-button:hover {
            background: rgba(255, 255, 255, 1);
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .settings-button:active {
            transform: scale(0.95);
        }

        .fullscreen-icon {
            position: relative;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Í∏∞Î≥∏ ÏÉÅÌÉú: ÌôïÎåÄ ÏïÑÏù¥ÏΩò ÌëúÏãú, Ï∂ïÏÜå ÏïÑÏù¥ÏΩò Ïà®ÍπÄ */
        .fullscreen-icon .expand-icon {
            display: block;
        }

        .fullscreen-icon .minimize-icon {
            display: none;
        }

        /* Ï†ÑÏ≤¥ÌôîÎ©¥ ÏÉÅÌÉú: ÌôïÎåÄ ÏïÑÏù¥ÏΩò Ïà®ÍπÄ, Ï∂ïÏÜå ÏïÑÏù¥ÏΩò ÌëúÏãú */
        .fullscreen-icon.minimize .expand-icon {
            display: none;
        }

        .fullscreen-icon.minimize .minimize-icon {
            display: block;
        }

        /* SVG ÏïÑÏù¥ÏΩò Ïä§ÌÉÄÏùº */
        .fullscreen-icon svg {
            transition: all 0.2s ease;
        }

        .fullscreen-button:hover .fullscreen-icon svg {
            transform: scale(1.1);
        }

        /* Ï†ÑÏ≤¥ÌôîÎ©¥ Î™®ÎìúÏùº Îïå */
        .fullscreen-mode {
            margin: 0 !important;
            padding: 0 !important;
        }

        .fullscreen-mode .board-container {
            padding: 2px 2vw !important;
            margin: 0 !important;
            overflow: hidden !important;
            clip-path: inset(0) !important;
        }

        .fullscreen-mode .game-board {
            width: 95vw;
            height: calc(100% - 4px);
            margin: 0 !important;
            overflow: hidden !important;
            clip-path: inset(0) !important;
        }

        .fullscreen-mode .center-panel {
            width: calc(95vw * 4.5 / 7);
            max-width: calc(95vw * 4.5 / 7);
            min-width: calc(95vw * 4.5 / 7);
            box-sizing: border-box;
        }


        /* ÏÉàÎ°úÏö¥ SVG Í∏∞Î∞ò Ï£ºÏÇ¨ÏúÑ Ïä§ÌÉÄÏùº */
        .dice-display {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .dice-icon {
            width: 64px;
            height: 64px;
            fill: #374151;
        }

        /* Ï£ºÏÇ¨ÏúÑ ÌëúÏãú ÏòÅÏó≠Ïùò Ï£ºÏÇ¨ÏúÑ ÏïÑÏù¥ÏΩò Ïä§ÌÉÄÏùº */
        #diceIcon {
            fill: #374151;
        }

        .dice-icon.spinning {
            animation: spin 0.1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .control-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .control-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .control-button:active {
            transform: translateY(0);
        }

        .control-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* ÌåùÏóÖ Ïä§ÌÉÄÏùº */
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        /* Ìô©Í∏à Ïó¥Ïá† ÌåùÏóÖÏùÄ Ïñ¥ÎëêÏö¥ Î∞∞Í≤Ω ÏóÜÏù¥ */
        #goldenKeyPopup {
            background: transparent;
        }

        .popup-overlay.show {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .popup-container {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            padding: 30px;
            max-width: 90vw;
            max-height: calc(var(--vh, 1vh) * 80);
            width: 500px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease;
            overflow-y: auto;
        }

        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(50px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        .popup-title {
            color: white;
            text-align: center;
            margin: 0 0 20px 0;
            font-size: 24px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .popup-content {
            color: white;
            text-align: center;
            margin: 0 0 25px 0;
            font-size: 16px;
            line-height: 1.5;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        }

        .popup-button {
            background: white;
            color: #333;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin: 10px 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .popup-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
            background: #f8f9fa;
        }

        /* Î∞òÏùëÌòï ÎîîÏûêÏù∏ */
        
        /* Ï†ÑÏ≤¥ÌôîÎ©¥ Î≤ÑÌäº Î∞òÏùëÌòï */
        @media (max-width: 768px) {
            .fullscreen-button {
                width: 35px;
                height: 35px;
                font-size: 16px;
                top: 8px;
                right: 8px;
            }
            .settings-button {
                width: 35px;
                height: 35px;
                font-size: 16px;
                top: 50px;
                right: 8px;
            }
        }

        @media (max-width: 480px) {
            .fullscreen-button {
                width: 30px;
                height: 30px;
                font-size: 14px;
                top: 5px;
                right: 5px;
            }
            .settings-button {
                width: 30px;
                height: 30px;
                font-size: 14px;
                top: 40px;
                right: 5px;
            }
        }
        
        /* Ï§ëÍ∞Ñ ÌÅ¨Í∏∞ ÌôîÎ©¥ - 2Ï§Ñ Î∞∞Ïπò (2x2) */
        @media (max-width: 900px) {
            .center-panel {
                padding: 15px 20px;
                gap: 12px;
                width: calc(85vw * 4.5 / 7);
                max-width: calc(85vw * 4.5 / 7);
                min-width: calc(85vw * 4.5 / 7);
                box-sizing: border-box;
            }
            
            .players-section {
                gap: 8px;
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .player-info {
                min-width: 180px;
                padding: 10px 12px;
                gap: 10px;
                flex: 1 1 calc(50% - 4px);
                max-width: calc(50% - 4px);
            }
            
            .player-avatar {
                width: 40px;
                height: 40px;
                font-size: 16px;
            }
            
            .player-name {
                font-size: 13px;
            }
            
            .player-score {
                font-size: 12px;
            }
            
            .player-lands {
                font-size: 11px;
            }
            
            .controls-section {
                gap: 10px;
            }
            
            .game-board {
                width: 85vw;
                height: calc(100% - 4px);
                aspect-ratio: 1.4 / 1;
            }
        }

        /* ÌÉúÎ∏îÎ¶ø ÌÅ¨Í∏∞ - 2Ï§Ñ Î∞∞Ïπò Ïú†ÏßÄ */
        @media (max-width: 768px) {
            .center-panel {
                padding: 15px 18px;
                gap: 10px;
                width: calc(85vw * 4.5 / 7);
                max-width: calc(85vw * 4.5 / 7);
                min-width: calc(85vw * 4.5 / 7);
                box-sizing: border-box;
            }
            
            .players-section {
                gap: 6px;
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .player-info {
                min-width: 160px;
                padding: 8px 10px;
                gap: 8px;
                flex: 1 1 calc(50% - 3px);
                max-width: calc(50% - 3px);
            }
            
            .player-avatar {
                width: 36px;
                height: 36px;
                font-size: 15px;
            }
            
            .player-name {
                font-size: 12px;
            }
            
            .player-score {
                font-size: 11px;
            }
            
            .player-lands {
                font-size: 10px;
            }
            
            .controls-section {
                gap: 8px;
            }
            
            .game-board {
                width: 85vw;
                height: calc(100% - 4px);
                aspect-ratio: 1.4 / 1;
            }
        }

        /* ÏûëÏùÄ ÌôîÎ©¥ - 4Ï§Ñ Î∞∞Ïπò (ÏÑ∏Î°ú) */
        @media (max-width: 600px) {
            .center-panel {
                padding: 12px 15px;
                gap: 8px;
                width: calc(90vw * 4.5 / 7);
                max-width: calc(90vw * 4.5 / 7);
                min-width: calc(90vw * 4.5 / 7);
                box-sizing: border-box;
            }
            
            .players-section {
                gap: 6px;
                flex-wrap: wrap;
                flex-direction: column;
                align-items: center;
            }
            
            .player-info {
                min-width: 220px;
                padding: 8px 12px;
                gap: 10px;
                flex: none;
                width: 100%;
                max-width: 250px;
            }
            
            .player-avatar {
                width: 32px;
                height: 32px;
                font-size: 14px;
            }
            
            .player-name {
                font-size: 12px;
            }
            
            .player-score {
                font-size: 11px;
            }
            
            .controls-section {
                gap: 8px;
            }
            
            .game-board {
                width: 90vw;
                height: calc(100% - 4px);
                aspect-ratio: 1.4 / 1;
            }
        }

        @media (max-width: 480px) {
            .center-panel {
                padding: 10px 12px;
                gap: 6px;
                width: calc(90vw * 4.5 / 7);
                max-width: calc(90vw * 4.5 / 7);
                min-width: calc(90vw * 4.5 / 7);
                box-sizing: border-box;
            }
            
            .players-section {
                gap: 4px;
                flex-wrap: wrap;
                flex-direction: column;
                align-items: center;
            }
            
            .player-info {
                min-width: 200px;
                padding: 6px 10px;
                gap: 8px;
                flex: none;
                width: 100%;
                max-width: 230px;
            }
            
            .player-avatar {
                width: 28px;
                height: 28px;
                font-size: 12px;
            }
            
            .player-name {
                font-size: 11px;
            }
            
            .player-score {
                font-size: 10px;
            }
            
            .player-lands {
                font-size: 9px;
            }
            
            .controls-section {
                gap: 8px;
            }
            
            .player-avatar {
                width: 30px;
                height: 30px;
                font-size: 12px;
            }
            
            .player-name {
                font-size: 12px;
            }
            
            .player-score {
                font-size: 10px;
            }
            
            .golden-keys {
                font-size: 10px;
            }
            
            .controls-section {
                gap: 8px;
            }
            
            .game-board {
                width: 90vw;
                height: calc(100% - 4px);
                aspect-ratio: 1.4 / 1;
            }
            
            .space-number {
                font-size: clamp(6px, 3vw, 14px);
            }
            
            .space-name {
                font-size: clamp(5px, 2.5vw, 10px);
            }
        }



        /* Ìô©Í∏à Ïó¥Ïá† Î∞úÍ≤¨ Î©îÏãúÏßÄ ÌåùÏóÖ */
        .golden-discovery-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: linear-gradient(135deg, #FFD700, #FFA500, #FFD700);
            border: 4px solid #B8860B;
            border-radius: 20px;
            padding: 30px 40px;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.8), 0 0 60px rgba(255, 165, 0, 0.6);
            z-index: 1000;
            text-align: center;
            font-family: 'Arial', sans-serif;
            min-width: 300px;
            max-width: 500px;
            opacity: 0;
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .golden-discovery-popup.show {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
        }


        .golden-event-title {
            font-size: 1.8em;
            font-weight: bold;
            color: #8B4513;
            margin: 0 0 15px 0;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .golden-event-content {
            font-size: 1.2em;
            color: #8B4513;
            margin: 0 0 20px 0;
            font-weight: 500;
        }

        .mystery-box-result {
            margin-top: 15px;
            padding: 10px;
            background: rgba(255, 215, 0, 0.2);
            border-radius: 8px;
            border: 1px solid #B8860B;
        }

        .mystery-box-result p {
            font-size: 1.1em;
            font-weight: bold;
            color: #8B4513;
            margin: 0;
            text-align: center;
        }

        .golden-event-actions {
            text-align: center;
        }

        .golden-event-actions .btn-confirm {
            background: linear-gradient(135deg, #B8860B, #DAA520, #B8860B);
            color: #fff;
            border: 2px solid #8B4513;
            border-radius: 10px;
            padding: 12px 30px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .golden-event-actions .btn-confirm:hover {
            background: linear-gradient(135deg, #DAA520, #FFD700, #DAA520);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }

        @keyframes goldenTextShine {
            0%, 100% { 
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            }
            50% { 
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3), 0 0 10px #FFD700, 0 0 20px #FFD700;
            }
        }

        /* Î≥¥Îìú Ïπ∏ ÏÉâÏÉÅ - CSS Î≥ÄÏàò ÏÇ¨Ïö© */
        .space-start { background: var(--color-start); color: #fff; }
        .space-quiz { background: var(--color-quiz); color: #fff; }
        .space-golden { background: var(--color-golden); color: #000; }
        .space-special { background: var(--color-special); color: #fff; }
        .space-corner { background: var(--color-corner); color: #fff; }
        .space-finish { background: var(--color-start); color: #fff; }
        .space-jail { background: var(--color-corner); color: #fff; }
        .space-free { background: var(--color-corner); color: #fff; }
        .space-goto { background: var(--color-corner); color: #fff; }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- Í≤åÏûÑ Î≥¥Îìú -->
        <div class="board-container">
            <!-- Ï†ÑÏ≤¥ÌôîÎ©¥ Î≤ÑÌäº -->
            <button class="fullscreen-button" id="fullscreenBtn" onclick="toggleFullscreen()" title="Ï†ÑÏ≤¥ÌôîÎ©¥ ÌÜ†Í∏Ä">
                <div class="fullscreen-icon" id="fullscreenIcon">
                    <!-- ÌôïÎåÄ ÏïÑÏù¥ÏΩò (Í∏∞Î≥∏ ÏÉÅÌÉú) - ÏÑúÎ°ú Î©ÄÏñ¥ÏßÄÎäî ÌôîÏÇ¥Ìëú -->
                    <svg class="expand-icon" viewBox="0 0 20 20" width="20" height="20">
                        <g transform="translate(10, 10) rotate(45)">
                            <!-- ÏôºÏ™ΩÏúºÎ°ú Ìñ•ÌïòÎäî ÌôîÏÇ¥Ìëú (Í∏∏Ïù¥ 2Î∞∞) -->
                            <path d="M -1 0 L -13 0" stroke="#333" stroke-width="1.5" fill="none"/>
                            <path d="M -9 -4 L -13 0 L -9 4" stroke="#333" stroke-width="1.5" fill="none" stroke-linejoin="round"/>
                            
                            <!-- Ïò§Î•∏Ï™ΩÏúºÎ°ú Ìñ•ÌïòÎäî ÌôîÏÇ¥Ìëú (Í∏∏Ïù¥ 2Î∞∞) -->
                            <path d="M 1 0 L 13 0" stroke="#333" stroke-width="1.5" fill="none"/>
                            <path d="M 9 -4 L 13 0 L 9 4" stroke="#333" stroke-width="1.5" fill="none" stroke-linejoin="round"/>
                        </g>
                    </svg>
                    <!-- Ï∂ïÏÜå ÏïÑÏù¥ÏΩò (Ï†ÑÏ≤¥ÌôîÎ©¥ ÏÉÅÌÉú) - ÏÑúÎ°úÎ•º Ìñ•ÌïòÎäî ÌôîÏÇ¥Ìëú -->
                    <svg class="minimize-icon" viewBox="0 0 20 20" width="20" height="20">
                        <g transform="translate(10, 10) rotate(45)">
                            <!-- Ïò§Î•∏Ï™ΩÏóêÏÑú ÏôºÏ™ΩÏúºÎ°ú Ìñ•ÌïòÎäî ÌôîÏÇ¥Ìëú (Í∏∏Ïù¥ 2Î∞∞) -->
                            <path d="M 13 0 L 1 0" stroke="#333" stroke-width="1.5" fill="none"/>
                            <path d="M 5 -4 L 1 0 L 5 4" stroke="#333" stroke-width="1.5" fill="none" stroke-linejoin="round"/>
                            
                            <!-- ÏôºÏ™ΩÏóêÏÑú Ïò§Î•∏Ï™ΩÏúºÎ°ú Ìñ•ÌïòÎäî ÌôîÏÇ¥Ìëú (Í∏∏Ïù¥ 2Î∞∞) -->
                            <path d="M -13 0 L -1 0" stroke="#333" stroke-width="1.5" fill="none"/>
                            <path d="M -5 -4 L -1 0 L -5 4" stroke="#333" stroke-width="1.5" fill="none" stroke-linejoin="round"/>
                        </g>
                    </svg>
            </div>
            </button>

            <!-- ÏÑ§Ï†ï Î≤ÑÌäº -->
            <button class="settings-button" id="settingsBtn" onclick="openSettings()" title="Í≤åÏûÑ ÏÑ§Ï†ï">
                <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="#333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="3"/>
                    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                </svg>
            </button>

            <!-- Ï§ëÏïô UI Ìå®ÎÑê -->
            <div class="center-panel">
            <!-- ÌîåÎ†àÏù¥Ïñ¥ Ï†ïÎ≥¥ -->
            <div class="players-section">
                <div class="player-info" id="player1-info">
                    <div class="player-avatar" style="background: var(--player-color-1);">1</div>
                    <div class="player-details">
                        <div class="player-name">ÌîåÎ†àÏù¥Ïñ¥ 1</div>
                        <div class="player-score">Ï†êÏàò: <span id="score1">0</span></div>
                        <div class="player-lands">ÎïÖ ÏÜåÏú†: <span id="lands1">0</span>Í∞ú</div>
                    </div>
                </div>
                
                <div class="player-info" id="player2-info">
                    <div class="player-avatar" style="background: var(--player-color-2);">2</div>
                    <div class="player-details">
                        <div class="player-name">ÌîåÎ†àÏù¥Ïñ¥ 2</div>
                        <div class="player-score">Ï†êÏàò: <span id="score2">0</span></div>
                        <div class="player-lands">ÎïÖ ÏÜåÏú†: <span id="lands2">0</span>Í∞ú</div>
                        </div>
                    </div>

                    <div class="player-info" id="player3-info">
                        <div class="player-avatar" style="background: var(--player-color-3);">3</div>
                        <div class="player-details">
                            <div class="player-name">ÌîåÎ†àÏù¥Ïñ¥ 3</div>
                            <div class="player-score">Ï†êÏàò: <span id="score3">0</span></div>
                            <div class="player-lands">ÎïÖ ÏÜåÏú†: <span id="lands3">0</span>Í∞ú</div>
                        </div>
                    </div>

                    <div class="player-info" id="player4-info">
                        <div class="player-avatar" style="background: var(--player-color-4);">4</div>
                        <div class="player-details">
                            <div class="player-name">ÌîåÎ†àÏù¥Ïñ¥ 4</div>
                            <div class="player-score">Ï†êÏàò: <span id="score4">0</span></div>
                            <div class="player-lands">ÎïÖ ÏÜåÏú†: <span id="lands4">0</span>Í∞ú</div>
                    </div>
                </div>
            </div>
            
            <!-- Í≤åÏûÑ Ïª®Ìä∏Î°§ -->
            <div class="controls-section">
                <div class="dice-controls">
                        <div class="dice-display" id="diceDisplay">
                            <svg class="dice-icon" id="diceIcon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect width="18" height="18" x="3" y="3" rx="2" ry="2"/>
                                <circle cx="12" cy="12" r="1"/>
                            </svg>
                        </div>
                    <button class="control-button" id="rollDiceBtn" onclick="rollDice()">
                            <span id="buttonText">Ï£ºÏÇ¨ÏúÑ Íµ¥Î¶¨Í∏∞</span>
                    </button>
                </div>
                </div>
            </div>
            
            <div class="game-board" id="gameBoard">
                <!-- Î≥¥Îìú Ïπ∏Îì§Ïù¥ JavaScriptÎ°ú ÎèôÏ†Å ÏÉùÏÑ±Îê©ÎãàÎã§ -->
            </div>
        </div>
    </div>

    <!-- ÌÄ¥Ï¶à ÌåùÏóÖ -->
    <div class="popup-overlay" id="quizPopup">
        <div class="popup-container">
            <h2 class="popup-title">üß† ÌÄ¥Ï¶à ÎèÑÏ†Ñ!</h2>
            <div class="popup-content" id="quizContent">
                <p id="quizQuestion">Î¨∏Ï†úÍ∞Ä Î°úÎìú Ï§ëÏûÖÎãàÎã§...</p>
                <div id="quizOptions"></div>
                <div id="quizTimer">‚è∞ ÎÇ®ÏùÄ ÏãúÍ∞Ñ: <span id="timeLeft">30</span>Ï¥à</div>
            </div>
        </div>
    </div>

    <!-- Ìô©Í∏à Ïó¥Ïá† ÌåùÏóÖ -->
    <div class="popup-overlay" id="goldenKeyPopup">
        <div class="popup-container">
            <h2 class="popup-title" id="eventTitle">‚ú® Ìô©Í∏à Ïó¥Ïá† Ïù¥Î≤§Ìä∏!</h2>
            <div class="popup-content" id="eventContent">
                <p id="eventDescription">Ïù¥Î≤§Ìä∏Í∞Ä Î°úÎìú Ï§ëÏûÖÎãàÎã§...</p>
            </div>
            <button class="popup-button" onclick="closeGoldenKey()">ÌôïÏù∏</button>
        </div>
    </div>

    <!-- Ìô©Í∏à Ïó¥Ïá† Ïù¥Î≤§Ìä∏ ÌåùÏóÖ -->
    <div class="golden-discovery-popup" id="goldenDiscoveryPopup">
        <div class="golden-event-title" id="discoveryEventTitle">‚ú® Ìô©Í∏à Ïó¥Ïá† Ïù¥Î≤§Ìä∏!</div>
        <div class="golden-event-content" id="discoveryEventContent">
            <p id="discoveryEventDescription">Ïù¥Î≤§Ìä∏Í∞Ä Î°úÎìú Ï§ëÏûÖÎãàÎã§...</p>
            <div class="mystery-box-result" id="mysteryBoxResult" style="display: none;">
                <p id="mysteryBoxResultText"></p>
            </div>
        </div>
        <div class="golden-event-actions">
            <button class="btn-confirm" onclick="closeGoldenDiscovery()">ÌôïÏù∏</button>
        </div>
    </div>

    <!-- ÌÑ¥ Ï†ÑÌôò ÏïåÎ¶º ÌåùÏóÖ -->
    <div class="popup-overlay" id="turnNotificationPopup">
        <div class="popup-container">
            <h2 class="popup-title">üéÆ ÌÑ¥ Ï†ÑÌôò</h2>
            <div class="popup-content">
                <p id="turnNotificationText">ÌîåÎ†àÏù¥Ïñ¥ 2Ïùò Ï∞®Î°ÄÏûÖÎãàÎã§.</p>
            </div>
            <button class="popup-button" onclick="closeTurnNotification()">ÌôïÏù∏</button>
        </div>
    </div>

    <!-- ÏÑ§Ï†ï Í¥ÄÎ¶¨ Ïä§ÌÅ¨Î¶ΩÌä∏ -->
    
    <script>
        // Í≤åÏûÑ ÏÉÅÌÉú
        let gameState = {
            players: [
                { id: 1, name: 'ÌîåÎ†àÏù¥Ïñ¥ 1', color: '#1976D2', position: 0, score: 0, isActive: true },
                { id: 2, name: 'ÌîåÎ†àÏù¥Ïñ¥ 2', color: '#E65100', position: 0, score: 0, isActive: false },
                { id: 3, name: 'ÌîåÎ†àÏù¥Ïñ¥ 3', color: '#2E7D32', position: 0, score: 0, isActive: false },
                { id: 4, name: 'ÌîåÎ†àÏù¥Ïñ¥ 4', color: '#9C27B0', position: 0, score: 0, isActive: false }
            ],
            currentPlayer: 1,
            gamePhase: 'waiting',
            diceValue: 0
        };

        // Î™®Î∞îÏùº Î∑∞Ìè¨Ìä∏ ÎÜíÏù¥ Î¨∏Ï†ú Ìï¥Í≤∞ Ìï®Ïàò
        function setViewportHeight() {
            // Ïã§Ï†ú Î∑∞Ìè¨Ìä∏ ÎÜíÏù¥Î•º Í∞ÄÏ†∏ÏòµÎãàÎã§ (Î∏åÎùºÏö∞Ï†Ä UI Ï†úÏô∏)
            const vh = window.innerHeight * 0.01;
            // CSS Î≥ÄÏàò --vhÏóê Í∞íÏùÑ ÏÑ§Ï†ïÌï©ÎãàÎã§
            document.documentElement.style.setProperty('--vh', `${vh}px`);
        }

        // Î∑∞Ìè¨Ìä∏ ÎÜíÏù¥ ÏÑ§Ï†ï Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà
        window.addEventListener('resize', setViewportHeight);
        window.addEventListener('orientationchange', setViewportHeight);
        window.addEventListener('load', setViewportHeight);
        
        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï¶âÏãú Ïã§Ìñâ
        document.addEventListener('DOMContentLoaded', setViewportHeight);


        // 7x7 Î≥¥Îìú Ïπ∏ Îç∞Ïù¥ÌÑ∞ (Ïä§ÌÅ¨Î¶∞ÏÉ∑ Í∏∞Ï§Ä)
        const boardSpaces = [
            // ÏãúÏûëÏ†ê (0) - Ïö∞ÌïòÎã®
            { id: 0, name: 'ÏãúÏûë', type: 'start', color: 'space-start' },
            // ÌïòÎã® Î≥Ä (1-5) - Ïò§Î•∏Ï™ΩÏóêÏÑú ÏôºÏ™ΩÏúºÎ°ú
            { id: 1, name: '1', type: 'quiz', color: 'space-quiz' },
            { id: 2, name: '2', type: 'quiz', color: 'space-quiz' },
            { id: 3, name: 'Ìô©Í∏àÏó¥Ïá†', type: 'golden', color: 'space-golden' },
            { id: 4, name: '4', type: 'quiz', color: 'space-quiz' },
            { id: 5, name: '5', type: 'quiz', color: 'space-quiz' },
            // Ï¢åÏ∏° Î≥Ä (7-11) - ÏïÑÎûòÏóêÏÑú ÏúÑÎ°ú
            { id: 7, name: '7', type: 'quiz', color: 'space-quiz' },
            { id: 8, name: '8', type: 'quiz', color: 'space-quiz' },
            { id: 9, name: 'Ìô©Í∏àÏó¥Ïá†', type: 'golden', color: 'space-golden' },
            { id: 10, name: '10', type: 'quiz', color: 'space-quiz' },
            { id: 11, name: '11', type: 'quiz', color: 'space-quiz' },
            // ÏÉÅÎã® Î≥Ä (13-17) - ÏôºÏ™ΩÏóêÏÑú Ïò§Î•∏Ï™ΩÏúºÎ°ú
            { id: 13, name: '13', type: 'quiz', color: 'space-quiz' },
            { id: 14, name: '14', type: 'quiz', color: 'space-quiz' },
            { id: 15, name: 'Ìô©Í∏àÏó¥Ïá†', type: 'golden', color: 'space-golden' },
            { id: 16, name: '16', type: 'quiz', color: 'space-quiz' },
            { id: 17, name: '17', type: 'quiz', color: 'space-quiz' },
            // Ïö∞Ï∏° Î≥Ä (19-23) - ÏúÑÏóêÏÑú ÏïÑÎûòÎ°ú
            { id: 19, name: '19', type: 'quiz', color: 'space-quiz' },
            { id: 20, name: '20', type: 'quiz', color: 'space-quiz' },
            { id: 21, name: 'Ìô©Í∏àÏó¥Ïá†', type: 'golden', color: 'space-golden' },
            { id: 22, name: '22', type: 'quiz', color: 'space-quiz' },
            { id: 23, name: '23', type: 'quiz', color: 'space-quiz' },
            // ÌäπÎ≥Ñ Ïπ∏Îì§ (Î™®ÏÑúÎ¶¨) - BoardColorTest.htmlÍ≥º ÎèôÏùºÌïòÍ≤å corner ÌÉÄÏûÖÏúºÎ°ú Î≥ÄÍ≤Ω
            { id: 6, name: 'Î¨¥Î£åÏ£ºÏ∞®', type: 'corner', color: 'space-corner' },
            { id: 12, name: 'Ï∂úÎ∞úÏßÄÎ°ú', type: 'corner', color: 'space-corner' },
            { id: 18, name: 'Í∞êÏò•', type: 'corner', color: 'space-corner' },
            { id: 24, name: 'ÌäπÎ≥ÑÏπ∏', type: 'special', color: 'space-special' }
        ];

        // ÌÄ¥Ï¶à Îç∞Ïù¥ÌÑ∞
        const quizQuestions = [
            {
                question: "1 + 1ÏùÄ?",
                options: ["1", "2", "3", "4"],
                correct: 1,
                points: 100
            },
            {
                question: "ÌÉúÏñëÍ≥ÑÏóêÏÑú Í∞ÄÏû• ÌÅ∞ ÌñâÏÑ±ÏùÄ?",
                options: ["ÏßÄÍµ¨", "Î™©ÏÑ±", "ÌÜ†ÏÑ±", "ÌôîÏÑ±"],
                correct: 1,
                points: 200
            },
            {
                question: "ÌïúÍµ≠Ïùò ÏàòÎèÑÎäî?",
                options: ["Î∂ÄÏÇ∞", "ÏÑúÏö∏", "ÎåÄÍµ¨", "Ïù∏Ï≤ú"],
                correct: 1,
                points: 100
            },
            {
                question: "2 √ó 3ÏùÄ?",
                options: ["5", "6", "7", "8"],
                correct: 1,
                points: 150
            },
            {
                question: "ÏßÄÍµ¨ÏóêÏÑú Í∞ÄÏû• ÌÅ∞ ÎåÄÎ•ôÏùÄ?",
                options: ["ÏïÑÏãúÏïÑ", "ÏïÑÌîÑÎ¶¨Ïπ¥", "Ïú†ÎüΩ", "Î∂ÅÏïÑÎ©îÎ¶¨Ïπ¥"],
                correct: 0,
                points: 200
            }
        ];

        // Ìô©Í∏à Ïó¥Ïá† Ïù¥Î≤§Ìä∏
        const goldenKeyEvents = [
            {
                name: "üöÄ Î°úÏºì Î∂ÄÏä§ÌÑ∞",
                description: "Ï¶âÏãú Ï∂úÎ∞úÏßÄÎ°ú ÏõåÌîÑ Ïù¥Îèô! ÌÜµÍ≥º Î≥¥ÎÑàÏä§ 400Ï†ê ÌöçÎìù!",
                effect: () => {
                    const player = gameState.players.find(p => p.id === gameState.currentPlayer);
                    player.position = 0;
                    player.score += 400;
                    updateUI();
                }
            },
            {
                name: "üí∞ Î≥µÍ∂å ÎãπÏ≤®",
                description: "Ï∂ïÌïòÌï©ÎãàÎã§! 500Ï†êÏùÑ ÌöçÎìùÌñàÏäµÎãàÎã§!",
                effect: () => {
                    const player = gameState.players.find(p => p.id === gameState.currentPlayer);
                    player.score += 500;
                    updateUI();
                }
            },
            {
                name: "üå™Ô∏è ÌÜ†ÎÑ§Ïù¥ÎèÑ ÏäµÍ≤©",
                description: "Îã§Î•∏ ÌîåÎ†àÏù¥Ïñ¥Îì§Ïù¥ ÎûúÎç§ ÏúÑÏπòÎ°ú Ìù©Ïñ¥ÏßÄÍ≥† 50Ï†êÏî© Ï∞®Í∞êÎê©ÎãàÎã§!",
                effect: () => {
                    const currentPlayerId = gameState.currentPlayer;
                    gameState.players.forEach(player => {
                        // ÌòÑÏû¨ ÌîåÎ†àÏù¥Ïñ¥(Ìô©Í∏à Ïó¥Ïá†Ïóê ÎèÑÏ∞©Ìïú ÌîåÎ†àÏù¥Ïñ¥)Îäî Ï†úÏô∏
                        if (player.id !== currentPlayerId) {
                            player.position = Math.floor(Math.random() * 24);
                            player.score = Math.max(0, player.score - 50);
                        }
                    });
                    updatePlayerPieces();
                    updateUI();
                }
            },
            {
                name: "üéÅ Ïã†ÎπÑÌïú ÏÉÅÏûê",
                description: "ÏÉÅÏûêÎ•º Ïó¥Ïñ¥Î≥¥ÏÑ∏Ïöî! 500Ï†ê, 0Ï†ê, ÎòêÎäî -200Ï†ê Ï§ë ÌïòÎÇòÎ•º ÌöçÎìùÌï©ÎãàÎã§!",
                effect: () => {
                    // Ïã†ÎπÑÌïú ÏÉÅÏûê Ïù¥Î≤§Ìä∏Îäî ÌåùÏóÖÏóêÏÑú ÏßÅÏ†ë Ï≤òÎ¶¨ÎêòÎØÄÎ°ú Ïó¨Í∏∞ÏÑúÎäî ÏïÑÎ¨¥Í≤ÉÎèÑ ÌïòÏßÄ ÏïäÏùå
                }
            }
        ];

        // Í≤åÏûÑ Ï¥àÍ∏∞Ìôî
        function initGame() {
            // Î∑∞Ìè¨Ìä∏ ÎÜíÏù¥ ÏÑ§Ï†ï
            setViewportHeight();
            
            // Í∏∞Î≥∏ ÌåîÎ†àÌä∏(Ïò§ÏÖò ÌÜ§) Ï†ÅÏö©
            const defaultPalette = palettesData.palettes[0]; // Ïò§ÏÖò ÌÜ§
            
            // CSS Î≥ÄÏàò ÏóÖÎç∞Ïù¥Ìä∏
            document.documentElement.style.setProperty('--color-start', defaultPalette.colors.golden);
            document.documentElement.style.setProperty('--color-quiz', defaultPalette.colors.quiz);
            document.documentElement.style.setProperty('--color-golden', defaultPalette.colors.golden);
            document.documentElement.style.setProperty('--color-special', defaultPalette.colors.special);
            document.documentElement.style.setProperty('--color-corner', defaultPalette.colors.corner);
            document.documentElement.style.setProperty('--color-center', defaultPalette.colors.center);
            document.documentElement.style.setProperty('--color-background', defaultPalette.colors.background);
            document.documentElement.style.setProperty('--color-normal', defaultPalette.colors.normal);
            
            // ÌåîÎ†àÌä∏Î≥Ñ ÌîåÎ†àÏù¥Ïñ¥ ÏÉâÏÉÅ CSS Î≥ÄÏàò ÏÑ§Ï†ï
            defaultPalette.playerColors.forEach((color, index) => {
                document.documentElement.style.setProperty(`--player-color-${index + 1}`, color);
            });
            
            // ÌîåÎ†àÏù¥Ïñ¥ ÏÉâÏÉÅ ÏóÖÎç∞Ïù¥Ìä∏
            defaultPalette.playerColors.forEach((color, index) => {
                if (gameState.players[index]) {
                    gameState.players[index].color = color;
                }
            });
            
            // Î≥¥Îìú ÏÉùÏÑ±
            createBoard();
            
            // Ï¥àÍ∏∞ Ï£ºÏÇ¨ÏúÑ Í∞í ÏÑ§Ï†ï (1Î°ú ÏãúÏûë)
            gameState.diceValue = 1;
            updateDiceIcon(1);
            updateUI();
            
            // ÏÜåÏú†Í∂å Ï¥àÍ∏∞Ìôî Î∞è Îù†ÏßÄ ÏÉâÏÉÅ ÏÑ§Ï†ï
            resetSpaceOwners();
            // Î≥¥Îìú ÏÉùÏÑ± ÌõÑ Îù†ÏßÄ ÏÉâÏÉÅ Ï¥àÍ∏∞Ìôî
            setTimeout(() => {
                updateRibbonColors();
                updateLandOwnershipDisplay(); // ÎïÖ ÏÜåÏú† ÌëúÏãú Ï¥àÍ∏∞Ìôî
            }, 100);
        }

        // Î™®ÎÖ∏Ìè¥Î¶¨ Ïä§ÌÉÄÏùº Î≥¥Îìú ÏÉùÏÑ±
        function createBoard() {
            const board = document.getElementById('gameBoard');
            board.innerHTML = '';

            // 7x7 Í∑∏Î¶¨Îìú ÏÉùÏÑ±
            for (let row = 0; row < 7; row++) {
                for (let col = 0; col < 7; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'board-space';
                    
                    // Î™®ÏÑúÎ¶¨ Ïπ∏Îì§
                    if ((row === 0 && col === 0) || (row === 0 && col === 6) || 
                        (row === 6 && col === 0) || (row === 6 && col === 6)) {
                        cell.classList.add('corner-space');
                        
                        if (row === 0 && col === 0) {
                            // Ï∂úÎ∞úÏßÄÎ°ú - special ÌÉÄÏûÖ
                            const space = boardSpaces.find(s => s.id === 12);
                            if (space) {
                                cell.className = `board-space corner-space ${space.color}`;
                            }
                            cell.innerHTML = '<div class="space-name">Ï∂úÎ∞úÏßÄÎ°ú</div>';
                            cell.onclick = () => handleSpaceClick(12);
                        } else if (row === 0 && col === 6) {
                            // Í∞êÏò• - special ÌÉÄÏûÖ
                            const space = boardSpaces.find(s => s.id === 18);
                            if (space) {
                                cell.className = `board-space corner-space ${space.color}`;
                            }
                            cell.innerHTML = '<div class="space-name">Í∞êÏò•</div>';
                            cell.onclick = () => handleSpaceClick(18);
                        } else if (row === 6 && col === 0) {
                            // Î¨¥Î£åÏ£ºÏ∞® - special ÌÉÄÏûÖ
                            const space = boardSpaces.find(s => s.id === 6);
                            if (space) {
                                cell.className = `board-space corner-space ${space.color}`;
                            }
                            cell.innerHTML = '<div class="space-name">Î¨¥Î£åÏ£ºÏ∞®</div>';
                            cell.onclick = () => handleSpaceClick(6);
                        } else if (row === 6 && col === 6) {
                            // ÏãúÏûë - start ÌÉÄÏûÖ
                            const space = boardSpaces.find(s => s.id === 0);
                            if (space) {
                                cell.className = `board-space corner-space ${space.color}`;
                            }
                            cell.innerHTML = '<div class="space-name">ÏãúÏûë</div>';
                            cell.onclick = () => handleSpaceClick(0);
                        }
                        
                        // Ï§ëÏïô Ìå®ÎÑêÍ≥º Í≤πÏπòÎäî Î™®ÏÑúÎ¶¨ Ïπ∏Îì§ÏùÄ Ìò∏Î≤Ñ Ìö®Í≥º ÎπÑÌôúÏÑ±Ìôî
                        if ((row >= 2 && row <= 4) && (col >= 2 && col <= 4)) {
                            cell.className += ' center-background';
                        }
                    }
                    // ÎÇ¥Î∂Ä 5x5 Í∑∏Î¶¨Îìú (ÎπàÏπ∏Îì§)
                    else if (row >= 1 && row <= 5 && col >= 1 && col <= 5) {
                        // ÎπàÏπ∏Îì§ (ÌÄ¥Ï¶à, ÎßàÎ∏î Í∏ÄÏî® Ï†úÍ±∞)
                        cell.style.background = 'var(--color-center)';
                        cell.style.border = 'none';
                        cell.style.boxShadow = 'none';
                        cell.style.outline = 'none';
                        cell.innerHTML = '';
                        cell.className = 'board-space center-background'; // Ìò∏Î≤Ñ Ìö®Í≥º ÎπÑÌôúÏÑ±Ìôî
                        // ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Ï†úÍ±∞ (onclick ÏÑ§Ï†ïÌïòÏßÄ ÏïäÏùå)
                    }
                    // Í≤ΩÍ≥Ñ Ïπ∏Îì§ (Ïô∏Í≥Ω Í≤ΩÎ°ú)
                    else {
                        const spaceIndex = getSpaceIndex(row, col);
                        if (spaceIndex !== -1) {
                            const space = boardSpaces.find(s => s.id === spaceIndex);
                            if (space) {
                                cell.className = `board-space ${space.color}`;
                                cell.dataset.space = spaceIndex; // Îù†ÏßÄ ÏãúÏä§ÌÖúÏùÑ ÏúÑÌïú data-space ÏÜçÏÑ± Ï∂îÍ∞Ä
                                cell.innerHTML = `
                                    <div class="space-number">${space.id}</div>
                                    <div class="space-name">${space.name}</div>
                                `;
                                
                                // Ï§ëÏïô Ìå®ÎÑêÍ≥º Í≤πÏπòÎäî ÏòÅÏó≠Ïùò Ïπ∏Îì§ÏùÄ ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Ï†úÍ±∞
                                if ((row >= 2 && row <= 4) && (col >= 2 && col <= 4)) {
                                    cell.className += ' center-background';
                                    // ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Ï†úÍ±∞ (onclick ÏÑ§Ï†ïÌïòÏßÄ ÏïäÏùå)
                                } else {
                                    cell.onclick = () => handleSpaceClick(space.id);
                                }
                            }
                        } else {
                            cell.style.background = 'transparent';
                            cell.style.border = 'none';
                            // Ï§ëÏïô Ìå®ÎÑêÍ≥º Í≤πÏπòÎäî ÏòÅÏó≠Ïùò Îπà Ïπ∏Îì§ÎèÑ Ìò∏Î≤Ñ Ìö®Í≥º ÎπÑÌôúÏÑ±Ìôî
                            if ((row >= 2 && row <= 4) && (col >= 2 && col <= 4)) {
                                cell.className = 'board-space center-background';
                            }
                        }
                    }
                    
                    board.appendChild(cell);
                }
            }

            // ÌîåÎ†àÏù¥Ïñ¥ ÎßêÎì§ Î∞∞Ïπò
            updatePlayerPieces();
        }

        // Í∑∏Î¶¨Îìú ÏúÑÏπòÎ•º Î≥¥Îìú Ïπ∏ Ïù∏Îç±Ïä§Î°ú Î≥ÄÌôò (Ïä§ÌÅ¨Î¶∞ÏÉ∑ Í∏∞Ï§Ä)
        function getSpaceIndex(row, col) {
            // ÏÉÅÎã® Î≥Ä (13-17) - ÏôºÏ™ΩÏóêÏÑú Ïò§Î•∏Ï™ΩÏúºÎ°ú
            if (row === 0 && col >= 1 && col <= 5) {
                return 12 + col; // 13, 14, 15, 16, 17
            }
            // Ïö∞Ï∏° Î≥Ä (19-23) - ÏúÑÏóêÏÑú ÏïÑÎûòÎ°ú
            else if (col === 6 && row >= 1 && row <= 5) {
                return 18 + row; // 19, 20, 21, 22, 23
            }
            // ÌïòÎã® Î≥Ä (1-5) - Ïò§Î•∏Ï™ΩÏóêÏÑú ÏôºÏ™ΩÏúºÎ°ú
            else if (row === 6 && col >= 1 && col <= 5) {
                return 6 - col; // 5, 4, 3, 2, 1
            }
            // Ï¢åÏ∏° Î≥Ä (7-11) - ÏïÑÎûòÏóêÏÑú ÏúÑÎ°ú
            else if (col === 0 && row >= 1 && row <= 5) {
                return 12 - row; // 11, 10, 9, 8, 7
            }
            return -1;
        }

        // ÌîåÎ†àÏù¥Ïñ¥ ÎßêÎì§ ÏóÖÎç∞Ïù¥Ìä∏
        function updatePlayerPieces() {
            // Í∏∞Ï°¥ ÎßêÎì§ Ï†úÍ±∞
            document.querySelectorAll('.player-piece').forEach(piece => piece.remove());

            // Í∞Å Ïπ∏Î≥ÑÎ°ú ÌîåÎ†àÏù¥Ïñ¥Îì§ÏùÑ Í∑∏Î£πÌôî
            const playersByPosition = {};
            gameState.players.forEach(player => {
                if (player.position >= 0 && player.position < boardSpaces.length) {
                    if (!playersByPosition[player.position]) {
                        playersByPosition[player.position] = [];
                    }
                    playersByPosition[player.position].push(player);
                }
            });

            // Í∞Å Ïπ∏Ïóê ÌîåÎ†àÏù¥Ïñ¥ ÎßêÎì§ Î∞∞Ïπò
            Object.keys(playersByPosition).forEach(position => {
                const players = playersByPosition[position];
                const gridPos = getGridPosition(parseInt(position));
                
                if (gridPos) {
                    const cellIndex = gridPos.row * 7 + gridPos.col;
                        const spaceElement = document.querySelectorAll('.board-space')[cellIndex];
                    
                        if (spaceElement) {
                        players.forEach((player, index) => {
                            const piece = document.createElement('div');
                            piece.className = 'player-piece';
                            piece.style.background = player.color;
                            piece.textContent = player.id;
                            
                            // ÏÉÅÎã® Ïö∞Ï∏° Ï†ïÎ†¨ Î∞∞Ïπò Í≥ÑÏÇ∞
                            const totalPlayers = players.length;
                            let rightPosition;
                            
                            if (totalPlayers === 1) {
                                rightPosition = '5%';
                            } else if (totalPlayers === 2) {
                                rightPosition = index === 0 ? '30%' : '5%';
                            } else if (totalPlayers === 3) {
                                rightPosition = index === 0 ? '55%' : index === 1 ? '30%' : '5%';
                            } else { // 4Î™Ö
                                rightPosition = index === 0 ? '80%' : index === 1 ? '55%' : index === 2 ? '30%' : '5%';
                            }
                            
                            piece.style.right = rightPosition;
                            piece.style.left = 'auto'; // left ÏÜçÏÑ± Ï¥àÍ∏∞Ìôî
                            spaceElement.appendChild(piece);
                        });
                    }
                }
            });
        }

        // Î≥¥Îìú Ïπ∏ Ïù∏Îç±Ïä§Î•º Í∑∏Î¶¨Îìú ÏúÑÏπòÎ°ú Î≥ÄÌôò (Ïä§ÌÅ¨Î¶∞ÏÉ∑ Í∏∞Ï§Ä)
        function getGridPosition(spaceIndex) {
            if (spaceIndex === 0) return { row: 6, col: 6 }; // ÏãúÏûë (Ïö∞ÌïòÎã®)
            if (spaceIndex === 6) return { row: 6, col: 0 }; // Î¨¥Î£åÏ£ºÏ∞® (Ï¢åÌïòÎã®)
            if (spaceIndex === 12) return { row: 0, col: 0 }; // Ï∂úÎ∞úÏßÄÎ°ú (Ï¢åÏÉÅÎã®)
            if (spaceIndex === 18) return { row: 0, col: 6 }; // Í∞êÏò• (Ïö∞ÏÉÅÎã®)
            
            // ÏÉÅÎã® Î≥Ä (13-17) - ÏôºÏ™ΩÏóêÏÑú Ïò§Î•∏Ï™ΩÏúºÎ°ú
            if (spaceIndex >= 13 && spaceIndex <= 17) {
                return { row: 0, col: spaceIndex - 12 };
            }
            // Ïö∞Ï∏° Î≥Ä (19-23) - ÏúÑÏóêÏÑú ÏïÑÎûòÎ°ú
            else if (spaceIndex >= 19 && spaceIndex <= 23) {
                return { row: spaceIndex - 18, col: 6 };
            }
            // ÌïòÎã® Î≥Ä (1-5) - Ïò§Î•∏Ï™ΩÏóêÏÑú ÏôºÏ™ΩÏúºÎ°ú
            else if (spaceIndex >= 1 && spaceIndex <= 5) {
                return { row: 6, col: 6 - spaceIndex };
            }
            // Ï¢åÏ∏° Î≥Ä (7-11) - ÏïÑÎûòÏóêÏÑú ÏúÑÎ°ú
            else if (spaceIndex >= 7 && spaceIndex <= 11) {
                return { row: 12 - spaceIndex, col: 0 };
            }
            
            return null;
        }

        // ÏÉàÎ°úÏö¥ SVG Í∏∞Î∞ò Ï£ºÏÇ¨ÏúÑ ÏãúÏä§ÌÖú
        let isRolling = false;
        
        // ÌÄ¥Ï¶à ÌÉÄÏù¥Î®∏ Î≥ÄÏàò
        let quizTimer = null;

        // ÏÜåÏú†Í∂å ÏãúÏä§ÌÖú
        let spaceOwners = {
            1: null, 2: null, 4: null, 5: null,      // 1Î≤à ÏßÄÏó≠
            7: null, 8: null, 10: null, 11: null,    // 2Î≤à ÏßÄÏó≠
            13: null, 14: null, 16: null, 17: null,  // 3Î≤à ÏßÄÏó≠
            19: null, 20: null, 22: null, 23: null   // 4Î≤à ÏßÄÏó≠
        };


        // Îù†ÏßÄ ÏÉâÏÉÅ ÏóÖÎç∞Ïù¥Ìä∏ Ìï®Ïàò (ÎèôÏ†Å ÌîåÎ†àÏù¥Ïñ¥ ÏÉâÏÉÅ ÏÇ¨Ïö©)
        function updateRibbonColors() {
            const spaces = document.querySelectorAll('.board-space[data-space]');
            if (spaces.length === 0) {
                return;
            }
            
            spaces.forEach(space => {
                const spaceNumber = parseInt(space.dataset.space);
                const ownerIndex = spaceOwners[spaceNumber];
                
                if (ownerIndex !== null && ownerIndex !== undefined) {
                    // ÌòÑÏû¨ Í≤åÏûÑ ÏÉÅÌÉúÏùò ÌîåÎ†àÏù¥Ïñ¥ ÏÉâÏÉÅ ÏÇ¨Ïö© (ÌåîÎ†àÌä∏ Î≥ÄÍ≤Ω Ïãú ÎèôÏ†ÅÏúºÎ°ú ÏóÖÎç∞Ïù¥Ìä∏Îê®)
                    const ownerColor = gameState.players[ownerIndex] ? gameState.players[ownerIndex].color : '#1976D2';
                    space.style.setProperty('--ribbon-color', ownerColor);
                    
                } else {
                    // ÏÜåÏú†ÏûêÍ∞Ä ÏóÜÏúºÎ©¥ Ìà¨Î™ÖÌïòÍ≤å
                    space.style.setProperty('--ribbon-color', 'transparent');
                }
            });
        }

        // ÏÜåÏú†Í∂å Ï¥àÍ∏∞Ìôî Ìï®Ïàò
        function resetSpaceOwners() {
            spaceOwners = {
                1: null, 2: null, 4: null, 5: null,      // 1Î≤à ÏßÄÏó≠
                7: null, 8: null, 10: null, 11: null,    // 2Î≤à ÏßÄÏó≠
                13: null, 14: null, 16: null, 17: null,  // 3Î≤à ÏßÄÏó≠
                19: null, 20: null, 22: null, 23: null   // 4Î≤à ÏßÄÏó≠
            };
        }

        // Ïπ∏ Íµ¨Îß§ Ìï®Ïàò (Î¨∏Ï†úÎ•º ÎßûÏ∑ÑÏùÑ Îïå Ìò∏Ï∂ú)
        function buySpace(playerIndex, spaceNumber) {
            if (spaceOwners[spaceNumber] === null) {
                spaceOwners[spaceNumber] = playerIndex;
                updateRibbonColors();
                updateLandOwnershipDisplay(); // ÎïÖ ÏÜåÏú† ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
            }
        }

        // ÎïÖ ÏÜåÏú† Í∞úÏàò Í≥ÑÏÇ∞ Ìï®Ïàò
        function getPlayerLandCount(playerIndex) {
            let count = 0;
            for (const spaceNumber in spaceOwners) {
                if (spaceOwners[spaceNumber] === playerIndex) {
                    count++;
                }
            }
            return count;
        }

        // ÎïÖ ÏÜåÏú† ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏ Ìï®Ïàò
        function updateLandOwnershipDisplay() {
            for (let i = 0; i < 4; i++) {
                const landCount = getPlayerLandCount(i);
                const landElement = document.getElementById(`lands${i + 1}`);
                if (landElement) {
                    landElement.textContent = landCount;
                }
            }
        }

        // Ï£ºÏÇ¨ÏúÑ ÏïÑÏù¥ÏΩò SVG Ìå®ÌÑ¥Îì§ (Ìù∞ÏÉâ Î∞∞Í≤Ω)
        const dicePatterns = {
            1: `<rect width="18" height="18" x="3" y="3" rx="2" ry="2" fill="white" stroke="#374151" stroke-width="1"/>
                <circle cx="12" cy="12" r="1" fill="#374151"/>`,
            
            2: `<rect width="18" height="18" x="3" y="3" rx="2" ry="2" fill="white" stroke="#374151" stroke-width="1"/>
                <circle cx="8" cy="8" r="1" fill="#374151"/>
                <circle cx="16" cy="16" r="1" fill="#374151"/>`,
            
            3: `<rect width="18" height="18" x="3" y="3" rx="2" ry="2" fill="white" stroke="#374151" stroke-width="1"/>
                <circle cx="8" cy="8" r="1" fill="#374151"/>
                <circle cx="12" cy="12" r="1" fill="#374151"/>
                <circle cx="16" cy="16" r="1" fill="#374151"/>`,
            
            4: `<rect width="18" height="18" x="3" y="3" rx="2" ry="2" fill="white" stroke="#374151" stroke-width="1"/>
                <circle cx="8" cy="8" r="1" fill="#374151"/>
                <circle cx="8" cy="16" r="1" fill="#374151"/>
                <circle cx="16" cy="8" r="1" fill="#374151"/>
                <circle cx="16" cy="16" r="1" fill="#374151"/>`,
            
            5: `<rect width="18" height="18" x="3" y="3" rx="2" ry="2" fill="white" stroke="#374151" stroke-width="1"/>
                <circle cx="8" cy="8" r="1" fill="#374151"/>
                <circle cx="8" cy="16" r="1" fill="#374151"/>
                <circle cx="12" cy="12" r="1" fill="#374151"/>
                <circle cx="16" cy="8" r="1" fill="#374151"/>
                <circle cx="16" cy="16" r="1" fill="#374151"/>`,
            
            6: `<rect width="18" height="18" x="3" y="3" rx="2" ry="2" fill="white" stroke="#374151" stroke-width="1"/>
                <circle cx="8" cy="8" r="1" fill="#374151"/>
                <circle cx="8" cy="12" r="1" fill="#374151"/>
                <circle cx="8" cy="16" r="1" fill="#374151"/>
                <circle cx="16" cy="8" r="1" fill="#374151"/>
                <circle cx="16" cy="12" r="1" fill="#374151"/>
                <circle cx="16" cy="16" r="1" fill="#374151"/>`
        };

        // Ï£ºÏÇ¨ÏúÑ ÏïÑÏù¥ÏΩò ÏóÖÎç∞Ïù¥Ìä∏ Ìï®Ïàò
        function updateDiceIcon(value) {
            const diceIcon = document.getElementById('diceIcon');
            diceIcon.innerHTML = dicePatterns[value];
        }

        // Ï£ºÏÇ¨ÏúÑ Íµ¥Î¶¨Í∏∞
        function rollDice() {
            if (gameState.gamePhase !== 'waiting' && gameState.gamePhase !== 'rolling') return;
            if (isRolling) return;

            const diceIcon = document.getElementById('diceIcon');
            const rollBtn = document.getElementById('rollDiceBtn');
            
            isRolling = true;
            gameState.gamePhase = 'rolling';
            
            // Ïï†ÎãàÎ©îÏù¥ÏÖò ÏãúÏûë
            diceIcon.classList.add('spinning');
            rollBtn.disabled = true;
            // Î≤ÑÌäº ÌÖçÏä§Ìä∏Îäî Í∑∏ÎåÄÎ°ú Ïú†ÏßÄ (ÌÅ¨Í∏∞ Î≥ÄÌôî Î∞©ÏßÄ)

            // ÌÖåÏä§Ìä∏Ïö©: Ìô©Í∏à Ïó¥Ïá† ÏúÑÏπòÎ°úÎßå Ïù¥ÎèôÌï† Ïàò ÏûàÎäî Í∞í Í≥ÑÏÇ∞
            const currentPlayer = gameState.players.find(p => p.id === gameState.currentPlayer);
            const currentPosition = currentPlayer.position;
            
            // Ìô©Í∏à Ïó¥Ïá† ÏúÑÏπò: 3, 9, 15, 21
            const goldenKeyPositions = [3, 9, 15, 21];
            
            // ÌòÑÏû¨ ÏúÑÏπòÏóêÏÑú Ìô©Í∏à Ïó¥Ïá†ÍπåÏßÄÏùò Í±∞Î¶¨ Í≥ÑÏÇ∞
            let possibleValues = [];
            goldenKeyPositions.forEach(goldenPos => {
                let distance = goldenPos - currentPosition;
                if (distance <= 0) {
                    distance += 24; // Î≥¥ÎìúÎ•º Ìïú Î∞îÌÄ¥ ÎèåÏïÑÏÑú ÎèÑÎã¨
                }
                if (distance >= 1 && distance <= 6) {
                    possibleValues.push(distance);
                }
            });
            
            // Í∞ÄÎä•Ìïú Í∞íÏù¥ ÏóÜÏúºÎ©¥ Í∏∞Î≥∏ ÎûúÎç§ Í∞í ÏÇ¨Ïö©
            const finalValue = possibleValues.length > 0 
                ? possibleValues[Math.floor(Math.random() * possibleValues.length)]
                : Math.floor(Math.random() * 6) + 1;
            
            // Ïï†ÎãàÎ©îÏù¥ÏÖò Ìö®Í≥ºÎ•º ÏúÑÌïú Ïó¨Îü¨ Î≤à Í∞í Î≥ÄÍ≤Ω
            let rolls = 0;
            const rollInterval = setInterval(() => {
                const tempValue = Math.floor(Math.random() * 6) + 1;
                updateDiceIcon(tempValue);
                rolls++;
                
                // 10Î≤à Íµ¥Î¶∞ ÌõÑ ÏµúÏ¢Ö Í∞íÏúºÎ°ú ÏÑ§Ï†ï
                if (rolls > 10) {
                    clearInterval(rollInterval);
                    gameState.diceValue = finalValue;
                    gameState.gamePhase = 'moving';
                    updateDiceIcon(finalValue);
                    
                    diceIcon.classList.remove('spinning');
                rollBtn.disabled = false;
                    isRolling = false;

                // ÌîåÎ†àÏù¥Ïñ¥ Ïù¥Îèô
                setTimeout(() => {
                        movePlayer(finalValue);
                    }, 300);
                }
            }, 100); // 100msÎßàÎã§ Ï£ºÏÇ¨ÏúÑ Í∞í Î≥ÄÍ≤Ω
        }

        // ÌîåÎ†àÏù¥Ïñ¥ Ïù¥Îèô
        function movePlayer(steps) {
            const player = gameState.players.find(p => p.id === gameState.currentPlayer);
            const startPosition = player.position;
            let currentStep = 0;
            
            // Îã®Í≥ÑÎ≥Ñ Ïù¥Îèô Ïï†ÎãàÎ©îÏù¥ÏÖò
            const moveStep = () => {
                if (currentStep < steps) {
                    currentStep++;
                    let tempPosition = startPosition + currentStep;
            
            // Î≥¥ÎìúÎ•º Ìïú Î∞îÌÄ¥ ÎèåÎ©¥ ÏãúÏûëÏ†ê ÌÜµÍ≥º Î≥¥ÎÑàÏä§ (24Ïπ∏ Î≥¥Îìú)
                    if (tempPosition >= 24) {
                        tempPosition = tempPosition - 24;
                        if (currentStep === steps) { // ÎßàÏßÄÎßâ Îã®Í≥ÑÏóêÏÑúÎßå Î≥¥ÎÑàÏä§ Ï†ÅÏö©
                player.score += 200;
                showMessage('ÏãúÏûëÏ†ê ÌÜµÍ≥º Î≥¥ÎÑàÏä§! +200Ï†ê');
                        }
            }
            
                    // ÏûÑÏãú ÏúÑÏπòÎ°ú ÌîåÎ†àÏù¥Ïñ¥ Ïù¥Îèô (Ïï†ÎãàÎ©îÏù¥ÏÖòÏö©)
                    player.position = tempPosition;
            updatePlayerPieces();
                    
                    // Ïù¥Îèô Ïï†ÎãàÎ©îÏù¥ÏÖò Ìö®Í≥º
                    const playerPiece = document.querySelector(`.player-piece[style*="background: ${player.color}"]`);
                    if (playerPiece) {
                        playerPiece.classList.add('moving');
                        setTimeout(() => {
                            playerPiece.classList.remove('moving');
                        }, 600);
                    }
                    
                    // Îã§Ïùå Îã®Í≥ÑÎ°ú Ïù¥Îèô (0.4Ï¥à Í∞ÑÍ≤©)
                    setTimeout(moveStep, 400);
                } else {
                    // ÏµúÏ¢Ö ÏúÑÏπò ÏÑ§Ï†ï Î∞è Ï∞©ÏßÄ Ïï†ÎãàÎ©îÏù¥ÏÖò
                    let finalPosition = startPosition + steps;
                    if (finalPosition >= 24) {
                        finalPosition = finalPosition - 24;
                    }
                    player.position = finalPosition;
                    
                    // Ï∞©ÏßÄ Ïï†ÎãàÎ©îÏù¥ÏÖò
                    const playerPiece = document.querySelector(`.player-piece[style*="background: ${player.color}"]`);
                    if (playerPiece) {
                        playerPiece.classList.add('landing');
                        setTimeout(() => {
                            playerPiece.classList.remove('landing');
                        }, 400);
                    }
                    
            updateUI();

            // ÎèÑÏ∞©Ìïú Ïπ∏Ïùò Ïï°ÏÖò Ï≤òÎ¶¨
            setTimeout(() => {
                        handleSpaceAction(finalPosition);
            }, 500);
                }
            };
            
            // Ï≤´ Î≤àÏß∏ Îã®Í≥Ñ ÏãúÏûë
            moveStep();
        }

        // Ïπ∏ Ïï°ÏÖò Ï≤òÎ¶¨
        function handleSpaceAction(position) {
            const space = boardSpaces.find(s => s.id === position);
            if (!space) return;

            switch (space.type) {
                case 'start':
                    // ÏãúÏûëÏ†êÏùÄ Ïù¥ÎØ∏ ÌÜµÍ≥º Î≥¥ÎÑàÏä§Î°ú Ï≤òÎ¶¨Îê®
                    break;
                case 'quiz':
                    showQuiz();
                    return;
                case 'golden':
                    showGoldenKeyEvent();
                    return;
                case 'corner':
                    // corner ÌÉÄÏûÖ Ïπ∏Îì§Ïùò Ïù¥Î¶ÑÏóê Îî∞Îùº Îã§Î•∏ Ïï°ÏÖò ÏàòÌñâ
                    if (space.name === 'Í∞êÏò•') {
                        const jailPlayer = gameState.players.find(p => p.id === gameState.currentPlayer);
                        jailPlayer.position = 18; // Í∞êÏò•Ïóê Î®∏Î¨ºÍ∏∞ (Ïã§Ï†ú Í∞êÏò• ÏúÑÏπò)
                        showMessage('Í∞êÏò•Ïóê Í∞áÌòîÏäµÎãàÎã§! Îã§Ïùå ÌÑ¥Ïóê Ï£ºÏÇ¨ÏúÑÎ•º Íµ¥Î†§ÏÑú ÌÉàÏ∂úÌïòÏÑ∏Ïöî.');
                    } else if (space.name === 'Î¨¥Î£åÏ£ºÏ∞®') {
                        showMessage('Î¨¥Î£å Ï£ºÏ∞®! ÌäπÎ≥ÑÌïú ÏùºÏù¥ ÏóÜÏäµÎãàÎã§.');
                    } else if (space.name === 'Ï∂úÎ∞úÏßÄÎ°ú') {
                        const gotoPlayer = gameState.players.find(p => p.id === gameState.currentPlayer);
                        gotoPlayer.position = 0; // ÏãúÏûëÏ†êÏúºÎ°ú Ïù¥Îèô
                        gotoPlayer.score += 200;
                        showMessage('Ï∂úÎ∞úÏßÄÎ°ú Ïù¥Îèô! +200Ï†ê');
                    } else {
                        // Í∏∞ÌÉÄ Î™®ÏÑúÎ¶¨ Ïπ∏ÏùÄ Ìô©Í∏àÏó¥Ïá† Ïù¥Î≤§Ìä∏Î°ú Ï≤òÎ¶¨
                        showGoldenKeyEvent();
                    }
                    break;
                case 'special':
                    // special ÌÉÄÏûÖ Ïπ∏Îì§ÏùÄ Ìô©Í∏àÏó¥Ïá† Ïù¥Î≤§Ìä∏Î°ú Ï≤òÎ¶¨
                    showGoldenKeyEvent();
                    return;
                case 'finish':
                    const finishPlayer = gameState.players.find(p => p.id === gameState.currentPlayer);
                    finishPlayer.score += 500;
                    showMessage('ÎèÑÏ∞©Ï†ê ÎèÑÎã¨! +500Ï†ê');
                    break;
            }

            // ÏûêÎèôÏúºÎ°ú ÌÑ¥ Ï†ÑÌôò (ÌÑ¥ Ï¢ÖÎ£å Î≤ÑÌäº Ï†úÍ±∞)
            setTimeout(() => {
                endTurn();
            }, 2000); // 2Ï¥à ÌõÑ ÏûêÎèô ÌÑ¥ Ï†ÑÌôò
            updateUI();
        }

        // ÌÄ¥Ï¶à ÌëúÏãú
        function showQuiz() {
            try {
            const question = quizQuestions[Math.floor(Math.random() * quizQuestions.length)];
            const popup = document.getElementById('quizPopup');
            const questionEl = document.getElementById('quizQuestion');
            const optionsEl = document.getElementById('quizOptions');

                if (!popup || !questionEl || !optionsEl) {
                    return;
                }

            questionEl.textContent = question.question;
            optionsEl.innerHTML = '';

            question.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'popup-button';
                button.textContent = `${String.fromCharCode(65 + index)}. ${option}`;
                button.onclick = () => answerQuiz(index, question.correct, question.points);
                optionsEl.appendChild(button);
            });

            popup.classList.add('show');
            startQuizTimer();
            } catch (error) {
                showMessage('ÌÄ¥Ï¶àÎ•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.');
            }
        }

        // ÌÄ¥Ï¶à ÌÉÄÏù¥Î®∏
        function startQuizTimer() {
            // Í∏∞Ï°¥ ÌÉÄÏù¥Î®∏Í∞Ä ÏûàÎã§Î©¥ Ï†ïÎ¶¨
            if (quizTimer) {
                clearInterval(quizTimer);
                quizTimer = null;
            }
            
            let timeLeft = 30;
            const timerEl = document.getElementById('timeLeft');
            
            // Ï¥àÍ∏∞ ÏãúÍ∞Ñ ÌëúÏãú
            if (timerEl) {
                timerEl.textContent = timeLeft;
            }
            
            quizTimer = setInterval(() => {
                timeLeft--;
                if (timerEl) {
                timerEl.textContent = timeLeft;
                }
                
                if (timeLeft <= 0) {
                    clearInterval(quizTimer);
                    quizTimer = null;
                    answerQuiz(-1, 0, 0); // ÏãúÍ∞Ñ Ï¥àÍ≥º
                }
            }, 1000);
        }

        // ÌÄ¥Ï¶à ÎãµÎ≥Ä
        function answerQuiz(selected, correct, points) {
            const player = gameState.players.find(p => p.id === gameState.currentPlayer);
            const currentSpace = player.position;
            
            // ÏãúÍ∞Ñ Ï¥àÍ≥º Ï≤òÎ¶¨
            if (selected === -1) {
                showMessage('ÏãúÍ∞Ñ Ï¥àÍ≥º! Ï†êÏàò ÏóÜÏùå');
            } else if (selected === correct) {
                player.score += points;
                
                // ÌÄ¥Ï¶à Ïπ∏Ïù¥Í≥† ÏïÑÏßÅ ÏÜåÏú†ÏûêÍ∞Ä ÏóÜÎã§Î©¥ Íµ¨Îß§
                if (boardSpaces.find(s => s.id === currentSpace)?.type === 'quiz' && 
                    spaceOwners[currentSpace] === null) {
                    // ÌîåÎ†àÏù¥Ïñ¥ IDÎ•º 0Î∂ÄÌÑ∞ ÏãúÏûëÌïòÎäî Ïù∏Îç±Ïä§Î°ú Î≥ÄÌôò (1->0, 2->1, 3->2, 4->3)
                    const playerIndex = gameState.currentPlayer - 1;
                    buySpace(playerIndex, currentSpace);
                    showMessage(`Ï†ïÎãµ! +${points}Ï†ê ÌöçÎìù! Ïπ∏ ${currentSpace}ÏùÑ Íµ¨Îß§ÌñàÏäµÎãàÎã§!`);
                } else {
                    showMessage(`Ï†ïÎãµ! +${points}Ï†ê ÌöçÎìù!`);
                }
            } else {
                showMessage('ÌãÄÎ†∏ÏäµÎãàÎã§! Ï†êÏàò ÏóÜÏùå');
            }
            closeQuiz();
        }

        // ÌÄ¥Ï¶à Îã´Í∏∞
        function closeQuiz() {
            // ÌÉÄÏù¥Î®∏ Ï†ïÎ¶¨
            if (quizTimer) {
                clearInterval(quizTimer);
                quizTimer = null;
            }
            
            document.getElementById('quizPopup').classList.remove('show');
            // ÏûêÎèôÏúºÎ°ú ÌÑ¥ Ï†ÑÌôò
            setTimeout(() => {
                endTurn();
            }, 1500); // 1.5Ï¥à ÌõÑ ÏûêÎèô ÌÑ¥ Ï†ÑÌôò
        }

        // ÌòÑÏû¨ Ìô©Í∏à Ïó¥Ïá† Ïù¥Î≤§Ìä∏ Ï†ÄÏû• Î≥ÄÏàò
        let currentGoldenKeyEvent = null;

        // Ìô©Í∏à Ïó¥Ïá† Ïù¥Î≤§Ìä∏ ÌëúÏãú (Í∞ÑÏÜåÌôî Î≤ÑÏ†Ñ)
        function showGoldenDiscoveryMessage() {
            const event = goldenKeyEvents[Math.floor(Math.random() * goldenKeyEvents.length)];
            currentGoldenKeyEvent = event;
            
            const popup = document.getElementById('goldenDiscoveryPopup');
            const eventTitleEl = document.getElementById('discoveryEventTitle');
            const eventDescriptionEl = document.getElementById('discoveryEventDescription');
            const mysteryBoxResultEl = document.getElementById('mysteryBoxResult');
            const mysteryBoxResultTextEl = document.getElementById('mysteryBoxResultText');

            eventTitleEl.textContent = event.name;
            eventDescriptionEl.textContent = event.description;
            
            // Ïã†ÎπÑÌïú ÏÉÅÏûê Ïù¥Î≤§Ìä∏Ïù∏ Í≤ΩÏö∞ Í≤∞Í≥º ÏÉùÏÑ± Î∞è ÌëúÏãú
            if (event.name === "üéÅ Ïã†ÎπÑÌïú ÏÉÅÏûê") {
                const player = gameState.players.find(p => p.id === gameState.currentPlayer);
                const results = [
                    { points: 500, message: "üéâ ÎåÄÎ∞ï! Ìô©Í∏à Î≥¥Î¨ºÏùÑ Î∞úÍ≤¨ÌñàÏäµÎãàÎã§! +500Ï†ê!" },
                    { points: 0, message: "üòÖ Îπà ÏÉÅÏûêÏòÄÏäµÎãàÎã§... ÏïÑÎ¨¥Í≤ÉÎèÑ ÏñªÏßÄ Î™ªÌñàÏäµÎãàÎã§." },
                    { points: -200, message: "üí• Ìï®Ï†ïÏù¥ÏóàÏäµÎãàÎã§! ÏÉÅÏûêÏóêÏÑú ÎèÖÍ∞ÄÏä§Í∞Ä ÎÇòÏôÄ -200Ï†ê!" }
                ];
                const randomResult = results[Math.floor(Math.random() * results.length)];
                
                // Ï†êÏàò Ï†ÅÏö©
                const oldScore = player.score;
                player.score = Math.max(0, player.score + randomResult.points);
                const actualChange = player.score - oldScore;
                
                // Í≤∞Í≥º Î©îÏãúÏßÄ ÏÉùÏÑ±
                let resultMessage = randomResult.message;
                if (randomResult.points < 0 && actualChange > randomResult.points) {
                    resultMessage += ` (Ïã§Ï†ú Î≥ÄÌôî: ${actualChange}Ï†ê)`;
                }
                
                // Í≤∞Í≥º ÌëúÏãú
                mysteryBoxResultTextEl.textContent = resultMessage;
                mysteryBoxResultEl.style.display = 'block';
                
                // UI ÏóÖÎç∞Ïù¥Ìä∏
                updateUI();
            } else {
                mysteryBoxResultEl.style.display = 'none';
            }
            
            // ÌåùÏóÖ ÌëúÏãú
            popup.classList.add('show');
            
            // Ïã†ÎπÑÌïú ÏÉÅÏûê Ïù¥Î≤§Ìä∏Í∞Ä ÏïÑÎãå Í≤ΩÏö∞ÏóêÎßå ÏûêÎèô Ìö®Í≥º Ï†ÅÏö©
            if (event.name !== "üéÅ Ïã†ÎπÑÌïú ÏÉÅÏûê") {
                setTimeout(() => {
                    applyGoldenKeyEffect(event);
                }, 1000);
            }
        }

        // ÌÜµÌï©Îêú Ìô©Í∏à Ïó¥Ïá† ÌåùÏóÖ Îã´Í∏∞
        function closeGoldenDiscovery() {
            const popup = document.getElementById('goldenDiscoveryPopup');
            popup.classList.remove('show');
            
            // Îã§Ïùå ÌîåÎ†àÏù¥Ïñ¥Î°ú ÌÑ¥ Ï†ÑÌôò
            endTurn();
        }

        // Ìô©Í∏à Ïó¥Ïá† Ïù¥Î≤§Ìä∏ ÌëúÏãú (ÌÜµÌï© Î≤ÑÏ†Ñ ÏÇ¨Ïö©)
        function showGoldenKeyEvent() {
            // ÌÜµÌï©Îêú Ìô©Í∏à Ïó¥Ïá† Î∞úÍ≤¨ Î©îÏãúÏßÄ ÌëúÏãú
            showGoldenDiscoveryMessage();
        }

        // Ìô©Í∏à Ïó¥Ïá† Ìö®Í≥º Ï†ÅÏö©
        function applyGoldenKeyEffect(event) {
            if (event && event.effect) {
                event.effect();
            }
        }

        // Ìô©Í∏à Ïó¥Ïá† Îã´Í∏∞
        function closeGoldenKey() {
            document.getElementById('goldenKeyPopup').classList.remove('show');
            
            // Ïã†ÎπÑÌïú ÏÉÅÏûê Ïù¥Î≤§Ìä∏Ïù∏ Í≤ΩÏö∞ ÏÉÅÏûê Ïó¥Í∏∞ Ï≤òÎ¶¨
            if (currentGoldenKeyEvent && currentGoldenKeyEvent.name === "üéÅ Ïã†ÎπÑÌïú ÏÉÅÏûê") {
                setTimeout(() => {
                    currentGoldenKeyEvent.effect();
                    currentGoldenKeyEvent = null; // Ïù¥Î≤§Ìä∏ Ï¥àÍ∏∞Ìôî
                }, 500);
            } else {
                // Îã§Î•∏ Ïù¥Î≤§Ìä∏Îì§ÏùÄ Í∏∞Ï°¥ Î∞©ÏãùÎåÄÎ°ú ÌÑ¥ Ï†ÑÌôò
                setTimeout(() => {
                    endTurn();
                }, 1500); // 1.5Ï¥à ÌõÑ ÏûêÎèô ÌÑ¥ Ï†ÑÌôò
            }
        }

        // ÌÑ¥ Ï†ÑÌôò ÏïåÎ¶º ÌëúÏãú
        function showTurnNotification(message) {
            const popup = document.getElementById('turnNotificationPopup');
            const textEl = document.getElementById('turnNotificationText');
            
            textEl.textContent = message;
            popup.classList.add('show');
        }

        // ÌÑ¥ Ï†ÑÌôò ÏïåÎ¶º Îã´Í∏∞
        function closeTurnNotification() {
            document.getElementById('turnNotificationPopup').classList.remove('show');
        }

        // ÌÑ¥ Ï¢ÖÎ£å (ÏûêÎèô ÌÑ¥ Ï†ÑÌôò)
        function endTurn() {
            const previousPlayer = gameState.currentPlayer;
            gameState.currentPlayer = gameState.currentPlayer === 4 ? 1 : gameState.currentPlayer + 1;
            gameState.gamePhase = 'rolling';
            gameState.diceValue = 0;

            // Î¨ºÏùåÌëúÎ°ú Î∞îÍæ∏ÏßÄ ÏïäÍ≥† ÌòÑÏû¨ Ï£ºÏÇ¨ÏúÑ Í∞í Ïú†ÏßÄ
            document.getElementById('rollDiceBtn').disabled = false;

            // ÌÑ¥ Ï†ÑÌôò ÌåùÏóÖ ÌëúÏãú
            showTurnNotification(`ÌîåÎ†àÏù¥Ïñ¥ ${gameState.currentPlayer}Ïùò Ï∞®Î°ÄÏûÖÎãàÎã§.`);

            updateUI();
        }

        // UI ÏóÖÎç∞Ïù¥Ìä∏
        function updateUI() {
            // ÌîåÎ†àÏù¥Ïñ¥ Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
            gameState.players.forEach(player => {
                document.getElementById(`score${player.id}`).textContent = player.score;
            });

            // ÌòÑÏû¨ ÌîåÎ†àÏù¥Ïñ¥ ÌïòÏù¥ÎùºÏù¥Ìä∏
            updatePlayerHighlight();

            // Ï£ºÏÇ¨ÏúÑ ÌëúÏãú (ÏÉàÎ°úÏö¥ SVG ÏãúÏä§ÌÖú)
            if (gameState.diceValue) {
                updateDiceIcon(gameState.diceValue);
            }

            updatePlayerPieces();
        }

        // ÌîåÎ†àÏù¥Ïñ¥ ÌïòÏù¥ÎùºÏù¥Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
        function updatePlayerHighlight() {
            // Î™®Îì† ÌîåÎ†àÏù¥Ïñ¥ Ïπ¥ÎìúÏóêÏÑú active ÌÅ¥ÎûòÏä§ Ï†úÍ±∞
            document.querySelectorAll('.player-info').forEach(card => {
                card.classList.remove('active');
            });

            // ÌòÑÏû¨ ÌîåÎ†àÏù¥Ïñ¥ Ïπ¥ÎìúÏóê active ÌÅ¥ÎûòÏä§ Ï∂îÍ∞Ä
            const currentPlayerCard = document.getElementById(`player${gameState.currentPlayer}-info`);
            if (currentPlayerCard) {
                currentPlayerCard.classList.add('active');
            }
        }

        // Î©îÏãúÏßÄ ÌëúÏãú (Í∞úÏÑ†Îêú ÏïåÎ¶º)
        function showMessage(message) {
            // Í∏∞Ï°¥ ÏïåÎ¶º Ï†úÍ±∞
            const existingNotification = document.querySelector('.game-notification');
            if (existingNotification) {
                existingNotification.remove();
            }

            // ÏÉàÎ°úÏö¥ ÏïåÎ¶º ÏÉùÏÑ±
            const notification = document.createElement('div');
            notification.className = 'game-notification';
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                padding: 15px 25px;
                border-radius: 25px;
                font-size: 16px;
                font-weight: bold;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
                z-index: 2000;
                animation: slideDown 0.3s ease-out;
            `;

            // CSS Ïï†ÎãàÎ©îÏù¥ÏÖò Ï∂îÍ∞Ä
            if (!document.querySelector('#notification-styles')) {
                const style = document.createElement('style');
                style.id = 'notification-styles';
                style.textContent = `
                    @keyframes slideDown {
                        from { 
                            opacity: 0; 
                            transform: translateX(-50%) translateY(-20px); 
                        }
                        to { 
                            opacity: 1; 
                            transform: translateX(-50%) translateY(0); 
                        }
                    }
                `;
                document.head.appendChild(style);
            }

            document.body.appendChild(notification);

            // 3Ï¥à ÌõÑ ÏûêÎèô Ï†úÍ±∞
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.animation = 'slideDown 0.3s ease-out reverse';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.remove();
                        }
                    }, 300);
                }
            }, 3000);
        }

        // Ïπ∏ ÌÅ¥Î¶≠ Ï≤òÎ¶¨
        function handleSpaceClick(spaceId) {
            // Ïπ∏ ÌÅ¥Î¶≠ Ïãú Ï†ïÎ≥¥ ÌëúÏãú (ÏÑ†ÌÉùÏÇ¨Ìï≠)
            const space = boardSpaces.find(s => s.id === spaceId);
            if (space) {
                showMessage(`${space.name} (${space.type})`);
            }
        }

        // Ï†ÑÏ≤¥ÌôîÎ©¥ ÌÜ†Í∏Ä Ìï®Ïàò
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                // Ï†ÑÏ≤¥ÌôîÎ©¥ ÏßÑÏûÖ
                document.documentElement.requestFullscreen().then(() => {
                    document.body.classList.add('fullscreen-mode');
                    document.getElementById('fullscreenIcon').classList.add('minimize');
                    document.getElementById('fullscreenBtn').title = 'Ï†ÑÏ≤¥ÌôîÎ©¥ Ìï¥Ï†ú';
                }).catch(err => {
                    // Ï†ÑÏ≤¥ÌôîÎ©¥ ÏßÑÏûÖ Ïã§Ìå®
                });
            } else {
                // Ï†ÑÏ≤¥ÌôîÎ©¥ Ìï¥Ï†ú
                document.exitFullscreen().then(() => {
                    document.body.classList.remove('fullscreen-mode');
                    document.getElementById('fullscreenIcon').classList.remove('minimize');
                    document.getElementById('fullscreenBtn').title = 'Ï†ÑÏ≤¥ÌôîÎ©¥ ÌÜ†Í∏Ä';
                }).catch(err => {
                    // Ï†ÑÏ≤¥ÌôîÎ©¥ Ìï¥Ï†ú Ïã§Ìå®
                });
            }
        }

        // ÏÑ§Ï†ï Ï∞Ω Ïó¥Í∏∞ Ìï®Ïàò
        function openSettings() {
            const modal = document.getElementById('settingsModal');
            if (modal) {
                modal.style.display = 'flex';
            } else {
                createSettingsModal();
            }
        }

        function closeSettings() {
            const modal = document.getElementById('settingsModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        function createSettingsModal() {
            const modal = document.createElement('div');
            modal.id = 'settingsModal';
            modal.className = 'settings-modal';
            modal.innerHTML = `
                <div class="settings-container">
                    <div class="settings-header">
                        <h2>‚öôÔ∏è Í≤åÏûÑ ÏÑ§Ï†ï</h2>
                        <button class="close-btn" onclick="closeSettings()">‚úï</button>
                    </div>
                    <div class="settings-content">
                        <div class="settings-sidebar">
                            <div class="sidebar-item active" onclick="selectSettingsTab('color')">
                                üé® ÏÉâÏÉÅ
                            </div>
                            <div class="sidebar-item" onclick="selectSettingsTab('sound')">
                                üîä ÏÇ¨Ïö¥Îìú
                            </div>
                            <div class="sidebar-item" onclick="selectSettingsTab('game')">
                                üéÆ Í≤åÏûÑ
                            </div>
                            <div class="sidebar-item" onclick="selectSettingsTab('display')">
                                üì± ÌôîÎ©¥
                            </div>
                        </div>
                        <div class="settings-main">
                            <div class="settings-panel active" id="color-panel">
                                <h3>üé® ÏÉâÏÉÅ ÏÑ§Ï†ï</h3>
                                <div class="color-settings-layout">
                                    <div class="palette-selection">
                                        <div class="setting-group">
                                            <label>ÌåîÎ†àÌä∏ ÏÑ†ÌÉù</label>
                                            <div class="palette-list" id="paletteList">
                                                <!-- ÌåîÎ†àÌä∏Í∞Ä Ïó¨Í∏∞Ïóê ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îê©ÎãàÎã§ -->
                                            </div>
                                        </div>
                                    </div>
                                    <div class="palette-preview">
                                        <h4>ÎØ∏Î¶¨Î≥¥Í∏∞</h4>
                                        <div class="mini-board-container">
                                            <div class="mini-board" id="miniBoard">
                                                <!-- ÎØ∏Îãà Î≥¥ÎìúÍ∞Ä Ïó¨Í∏∞Ïóê ÏÉùÏÑ±Îê©ÎãàÎã§ -->
                                            </div>
                                        </div>
                                        <div class="palette-info">
                                            <div class="palette-name" id="selectedPaletteName">Ïò§ÏÖò ÌÜ§</div>
                                            <div class="palette-theme" id="selectedPaletteTheme">Î∞îÎã§ ÎäêÎÇå, ÏãúÏõêÌïòÍ≥† ÍπîÎÅîÌï®</div>
                                            <div class="palette-colors" id="selectedPaletteColors">
                                                <div class="color-item">
                                                    <span class="color-swatch" style="background: #FF5722;"></span>
                                                    <span>ÌîåÎ†àÏù¥Ïñ¥ 1</span>
                                                </div>
                                                <div class="color-item">
                                                    <span class="color-swatch" style="background: #3F51B5;"></span>
                                                    <span>ÌîåÎ†àÏù¥Ïñ¥ 2</span>
                                                </div>
                                                <div class="color-item">
                                                    <span class="color-swatch" style="background: #4CAF50;"></span>
                                                    <span>ÌîåÎ†àÏù¥Ïñ¥ 3</span>
                                                </div>
                                                <div class="color-item">
                                                    <span class="color-swatch" style="background: #FF9800;"></span>
                                                    <span>ÌîåÎ†àÏù¥Ïñ¥ 4</span>
                                                </div>
                                            </div>
                                        </div>
                                            <div class="preview-actions">
                                                <button class="btn-apply" onclick="applySelectedPalette()">Ï†ÅÏö©</button>
                                            </div>
                                    </div>
                                </div>
                            </div>
                            <div class="settings-panel" id="sound-panel">
                                <h3>üîä ÏÇ¨Ïö¥Îìú ÏÑ§Ï†ï</h3>
                                <div class="setting-group">
                                    <label>Ìö®Í≥ºÏùå Î≥ºÎ•®</label>
                                    <input type="range" min="0" max="100" value="80" class="volume-slider">
                                    <span class="volume-value">80%</span>
                                </div>
                                <div class="setting-group">
                                    <label>Î∞∞Í≤ΩÏùåÏïÖ Î≥ºÎ•®</label>
                                    <input type="range" min="0" max="100" value="60" class="volume-slider">
                                    <span class="volume-value">60%</span>
                                </div>
                                <div class="setting-group">
                                    <label><input type="checkbox"> ÏùåÏÜåÍ±∞</label>
                                </div>
                            </div>
                            <div class="settings-panel" id="game-panel">
                                <h3>üéÆ Í≤åÏûÑ ÏÑ§Ï†ï</h3>
                                <div class="setting-group">
                                    <label><input type="checkbox"> Ïï†ÎãàÎ©îÏù¥ÏÖò Ìö®Í≥º</label>
                                </div>
                                <div class="setting-group">
                                    <label><input type="checkbox"> ÏûêÎèô ÌÑ¥ Ï†ÑÌôò</label>
                                </div>
                            </div>
                            <div class="settings-panel" id="display-panel">
                                <h3>üì± ÌôîÎ©¥ ÏÑ§Ï†ï</h3>
                                <div class="setting-group">
                                    <label><input type="checkbox"> Ï†ÑÏ≤¥ÌôîÎ©¥ Î™®Îìú</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            // DOMÏù¥ ÏôÑÏ†ÑÌûà Î†åÎçîÎßÅÎêú ÌõÑ ÌåîÎ†àÌä∏ Î°úÎìú
            setTimeout(() => {
                loadPalettes();
                const newModal = document.getElementById('settingsModal');
                if (newModal) {
                    newModal.style.display = 'flex';
                }
            }, 100);
        }

        function selectSettingsTab(tabName) {
            // Î™®Îì† ÌÉ≠ ÎπÑÌôúÏÑ±Ìôî
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelectorAll('.settings-panel').forEach(panel => {
                panel.classList.remove('active');
            });
            
            // ÏÑ†ÌÉùÎêú ÌÉ≠ ÌôúÏÑ±Ìôî
            event.target.classList.add('active');
            document.getElementById(tabName + '-panel').classList.add('active');
        }

        // ÌåîÎ†àÌä∏ Îç∞Ïù¥ÌÑ∞Î•º JavaScript Î≥ÄÏàòÎ°ú ÏßÅÏ†ë Ìè¨Ìï®
        const palettesData = {
            "palettes": [
                {
                    "id": 0,
                    "name": "ÌåîÎ†àÌä∏ 1 - Ïò§ÏÖò ÌÜ§",
                    "theme": "Î∞îÎã§ ÎäêÎÇå, ÏãúÏõêÌïòÍ≥† ÍπîÎÅîÌï®",
                    "colors": {
                        "golden": "#FFD700",
                        "corner": "#4682B4",
                        "quiz": "#00CED1",
                        "special": "#6495ED",
                        "complete": "#FF7F50",
                        "center": "#E0F6FF",
                        "normal": "#B0E0E6",
                        "background": "#F0F8FF"
                    },
                    "playerColors": ["#E91E63", "#2196F3", "#4CAF50", "#9C27B0"]
                },
                {
                    "id": 1,
                    "name": "ÌåîÎ†àÌä∏ 2 - ÎπÑÎπÑÎìú ÌÜ§",
                    "theme": "ÏÉùÎèôÍ∞ê ÏûàÍ≥† Î∞ùÏùÄ ÎäêÎÇå, ÎÜíÏùÄ ÎåÄÎπÑ",
                    "colors": {
                        "golden": "#FFD700",
                        "corner": "#1E90FF",
                        "quiz": "#32CD32",
                        "special": "#8A2BE2",
                        "complete": "#FF6347",
                        "center": "#FFE4B5",
                        "normal": "#87CEEB",
                        "background": "#F0F8FF"
                    },
                    "playerColors": ["#F44336", "#4CAF50", "#2196F3", "#9C27B0"]
                },
                {
                    "id": 2,
                    "name": "ÌåîÎ†àÌä∏ 3 - Î™®Îçò ÎùºÏù¥Ìä∏",
                    "theme": "ÏÑ∏Î†®ÎêòÍ≥† Î∞ùÏùÄ ÎäêÎÇå, ÌòÑÎåÄÏ†Å",
                    "colors": {
                        "golden": "#FFD700",
                        "corner": "#4682B4",
                        "quiz": "#20B2AA",
                        "special": "#9370DB",
                        "complete": "#FF6B6B",
                        "center": "#F8F9FA",
                        "normal": "#E3F2FD",
                        "background": "#FAFAFA"
                    },
                    "playerColors": ["#FF5722", "#4CAF50", "#9C27B0", "#2196F3"]
                },
                {
                    "id": 3,
                    "name": "ÌåîÎ†àÌä∏ 4 - Ïõú ÎùºÏù¥Ìä∏",
                    "theme": "Îî∞ÎúªÌïòÍ≥† Î∞ùÏùÄ ÎäêÎÇå, ÏïÑÎäëÌï®",
                    "colors": {
                        "golden": "#FFD700",
                        "corner": "#FF8C00",
                        "quiz": "#00CED1",
                        "special": "#DA70D6",
                        "complete": "#FF1493",
                        "center": "#FFF8DC",
                        "normal": "#F0E68C",
                        "background": "#FFFACD"
                    },
                    "playerColors": ["#E91E63", "#4CAF50", "#9C27B0", "#2196F3"]
                },
                {
                    "id": 4,
                    "name": "ÌåîÎ†àÌä∏ 5 - Ïø® ÎùºÏù¥Ìä∏",
                    "theme": "ÏãúÏõêÌïòÍ≥† Ï∞®Î∂ÑÌïú ÎäêÎÇå, ÏßëÏ§ëÎ†• Ìñ•ÏÉÅ",
                    "colors": {
                        "golden": "#FFD700",
                        "corner": "#4169E1",
                        "quiz": "#00FA9A",
                        "special": "#6A5ACD",
                        "complete": "#FF69B4",
                        "center": "#F0FFFF",
                        "normal": "#E0FFFF",
                        "background": "#F0F8FF"
                    },
                    "playerColors": ["#FF5722", "#4CAF50", "#2196F3", "#9C27B0"]
                },
                {
                    "id": 5,
                    "name": "ÌåîÎ†àÌä∏ 6 - ÎÑ§Ïù¥Ï≤ò ÌÜ§",
                    "theme": "ÏûêÏó∞Ïä§ÎüΩÍ≥† Ìé∏ÏïàÌïú ÎäêÎÇå, ÌûêÎßÅ",
                    "colors": {
                        "golden": "#FFD700",
                        "corner": "#8FBC8F",
                        "quiz": "#90EE90",
                        "special": "#DDA0DD",
                        "complete": "#F0A0A0",
                        "center": "#F5FFFA",
                        "normal": "#E0FFE0",
                        "background": "#F0FFF0"
                    },
                    "playerColors": ["#E91E63", "#2196F3", "#9C27B0", "#4CAF50"]
                },
                {
                    "id": 6,
                    "name": "ÌåîÎ†àÌä∏ 7 - ÌååÏä§ÌÖî ÌÜ§",
                    "theme": "Î∂ÄÎìúÎüΩÍ≥† Î∞ùÏùÄ ÎäêÎÇå, Ïñ¥Î¶∞Ïù¥ ÏπúÌôîÏ†Å",
                    "colors": {
                        "golden": "#FFD700",
                        "corner": "#E6E6FA",
                        "quiz": "#B0E0E6",
                        "special": "#98FB98",
                        "complete": "#FFB6C1",
                        "center": "#F0F8FF",
                        "normal": "#FFFACD",
                        "background": "#F5F5F5"
                    },
                    "playerColors": ["#E91E63", "#2196F3", "#9C27B0", "#4CAF50"]
                },
                {
                    "id": 7,
                    "name": "ÌåîÎ†àÌä∏ 8 - ÏÑ†ÏÖã ÌÜ§",
                    "theme": "ÏùºÎ™∞ ÎäêÎÇå, Îî∞ÎúªÌïòÍ≥† Î°úÎß®Ìã±",
                    "colors": {
                        "golden": "#FFD700",
                        "corner": "#FF8C00",
                        "quiz": "#FFA500",
                        "special": "#FF6347",
                        "complete": "#FF4500",
                        "center": "#FFF8DC",
                        "normal": "#FFE4B5",
                        "background": "#FFFACD"
                    },
                    "playerColors": ["#F44336", "#4CAF50", "#2196F3", "#9C27B0"]
                },
                {
                    "id": 8,
                    "name": "ÌåîÎ†àÌä∏ 9 - ÎùºÎ≤§Îçî ÌÜ§",
                    "theme": "Î≥¥ÎùºÏÉâ Í≥ÑÏó¥, Ïö∞ÏïÑÌïòÍ≥† Í≥†Í∏âÏä§Îü¨ÏõÄ",
                    "colors": {
                        "golden": "#FFD700",
                        "corner": "#9370DB",
                        "quiz": "#DDA0DD",
                        "special": "#BA55D3",
                        "complete": "#FF69B4",
                        "center": "#F8F8FF",
                        "normal": "#E6E6FA",
                        "background": "#F0F0FF"
                    },
                    "playerColors": ["#FF5722", "#4CAF50", "#2196F3", "#E91E63"]
                },
                {
                    "id": 9,
                    "name": "ÌåîÎ†àÌä∏ 10 - ÎØºÌä∏ ÌÜ§",
                    "theme": "ÎØºÌä∏ÏÉâ Í≥ÑÏó¥, Ïã†ÏÑ†ÌïòÍ≥† ÍπîÎÅîÌï®",
                    "colors": {
                        "golden": "#FFD700",
                        "corner": "#20B2AA",
                        "quiz": "#00FA9A",
                        "special": "#40E0D0",
                        "complete": "#00CED1",
                        "center": "#F0FFFF",
                        "normal": "#E0FFFF",
                        "background": "#F5FFFA"
                    },
                    "playerColors": ["#E91E63", "#9C27B0", "#2196F3", "#4CAF50"]
                },
                {
                    "id": 10,
                    "name": "ÌåîÎ†àÌä∏ 11 - ÏΩîÎûÑ ÌÜ§",
                    "theme": "ÏΩîÎûÑÏÉâ Í≥ÑÏó¥, ÌôúÍ∏∞Ï∞®Í≥† ÏÉùÎèôÍ∞ê",
                    "colors": {
                        "golden": "#FFD700",
                        "corner": "#FF7F50",
                        "quiz": "#FF6347",
                        "special": "#FF69B4",
                        "complete": "#FF1493",
                        "center": "#FFF0F5",
                        "normal": "#FFE4E1",
                        "background": "#FFF5EE"
                    },
                    "playerColors": ["#4CAF50", "#2196F3", "#9C27B0", "#E91E63"]
                },
                {
                    "id": 11,
                    "name": "ÌåîÎ†àÌä∏ 12 - Ìè¨Î†àÏä§Ìä∏ ÌÜ§",
                    "theme": "Ïà≤ ÎäêÎÇå, ÏûêÏó∞Ïä§ÎüΩÍ≥† ÏïàÏ†ïÍ∞ê",
                    "colors": {
                        "golden": "#FFD700",
                        "corner": "#228B22",
                        "quiz": "#32CD32",
                        "special": "#9ACD32",
                        "complete": "#ADFF2F",
                        "center": "#F0FFF0",
                        "normal": "#E0FFE0",
                        "background": "#F5FFFA"
                    },
                    "playerColors": ["#E91E63", "#2196F3", "#9C27B0", "#4CAF50"]
                }
            ]
        };

        // ÌòÑÏû¨ Í≤åÏûÑÌåêÏóê Ï†ÅÏö©Îêú ÌåîÎ†àÌä∏Î•º Ï∞æÎäî Ìï®Ïàò
        function getCurrentPalette() {
            const currentStartColor = getComputedStyle(document.documentElement).getPropertyValue('--color-start').trim();
            const currentQuizColor = getComputedStyle(document.documentElement).getPropertyValue('--color-quiz').trim();
            
            // ÌòÑÏû¨ ÏÉâÏÉÅÍ≥º ÏùºÏπòÌïòÎäî ÌåîÎ†àÌä∏ Ï∞æÍ∏∞
            for (let i = 0; i < palettesData.palettes.length; i++) {
                const palette = palettesData.palettes[i];
                if (palette.colors.golden === currentStartColor && palette.colors.quiz === currentQuizColor) {
                    return i; // ÌåîÎ†àÌä∏ Ïù∏Îç±Ïä§ Î∞òÌôò
                }
            }
            return 0; // Í∏∞Î≥∏Í∞íÏúºÎ°ú Ï≤´ Î≤àÏß∏ ÌåîÎ†àÌä∏ Î∞òÌôò
        }

        function loadPalettes() {
            try {
                const paletteList = document.getElementById('paletteList');
                
                if (paletteList && palettesData.palettes) {
                    paletteList.innerHTML = '';
                    
                    // ÌòÑÏû¨ Ï†ÅÏö©Îêú ÌåîÎ†àÌä∏ Ïù∏Îç±Ïä§ Í∞ÄÏ†∏Ïò§Í∏∞
                    const currentPaletteIndex = getCurrentPalette();
                    
                    palettesData.palettes.forEach((palette, index) => {
                        const paletteItem = document.createElement('div');
                        paletteItem.className = 'palette-item';
                        
                        // ÌòÑÏû¨ ÌåîÎ†àÌä∏Ïù∏ Í≤ΩÏö∞ active ÌÅ¥ÎûòÏä§ Ï∂îÍ∞Ä
                        if (index === currentPaletteIndex) {
                            paletteItem.classList.add('active');
                            selectedPalette = palette; // ÌòÑÏû¨ ÌåîÎ†àÌä∏Î•º ÏÑ†ÌÉùÎêú ÌåîÎ†àÌä∏Î°ú ÏÑ§Ï†ï
                        }
                        
                        paletteItem.innerHTML = `
                            <div class="palette-name">${palette.name.replace('ÌåîÎ†àÌä∏ ', '').replace(/^\d+\s*-\s*/, '')}</div>
                        `;
                        paletteItem.onclick = () => selectPalette(index, palette);
                        paletteList.appendChild(paletteItem);
                    });
                    
                    // ÌòÑÏû¨ ÌåîÎ†àÌä∏Î°ú ÎØ∏Î¶¨Î≥¥Í∏∞ ÏóÖÎç∞Ïù¥Ìä∏
                    if (selectedPalette) {
                        updatePreview(selectedPalette);
                    }
                }
            } catch (error) {
                // ÌåîÎ†àÌä∏ Î°úÎî© Ïã§Ìå®
            }
        }

        let selectedPalette = null;

        function selectPalette(index, palette) {
            // Î™®Îì† ÌåîÎ†àÌä∏ ÏïÑÏù¥ÌÖúÏóêÏÑú active ÌÅ¥ÎûòÏä§ Ï†úÍ±∞
            document.querySelectorAll('.palette-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // ÏÑ†ÌÉùÎêú ÌåîÎ†àÌä∏Ïóê active ÌÅ¥ÎûòÏä§ Ï∂îÍ∞Ä
            event.currentTarget.classList.add('active');
            
            // ÏÑ†ÌÉùÎêú ÌåîÎ†àÌä∏ Ï†ÄÏû•
            selectedPalette = palette;
            
            // ÎØ∏Î¶¨Î≥¥Í∏∞ ÏóÖÎç∞Ïù¥Ìä∏
            updatePreview(palette);
        }

        function updatePreview(palette) {
            // ÌåîÎ†àÌä∏ Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏ (Î≤àÌò∏ Ï†úÍ±∞)
            const displayName = palette.name.replace(/ÌåîÎ†àÌä∏ \d+ - /, '');
            document.getElementById('selectedPaletteName').textContent = displayName;
            document.getElementById('selectedPaletteTheme').textContent = palette.theme;
            
            // ÌåîÎ†àÌä∏Î≥Ñ ÌîåÎ†àÏù¥Ïñ¥ ÏÉâÏÉÅ Ïä§ÏôÄÏπò ÏóÖÎç∞Ïù¥Ìä∏ (BoardColorTest.htmlÍ≥º ÎèôÏùº)
            const colorItems = document.querySelectorAll('#selectedPaletteColors .color-item');
            const playerColors = [
                { color: palette.playerColors[0], name: 'ÌîåÎ†àÏù¥Ïñ¥ 1' },
                { color: palette.playerColors[1], name: 'ÌîåÎ†àÏù¥Ïñ¥ 2' },
                { color: palette.playerColors[2], name: 'ÌîåÎ†àÏù¥Ïñ¥ 3' },
                { color: palette.playerColors[3], name: 'ÌîåÎ†àÏù¥Ïñ¥ 4' }
            ];
            
            colorItems.forEach((item, index) => {
                if (playerColors[index]) {
                    const swatch = item.querySelector('.color-swatch');
                    const name = item.querySelector('span:last-child');
                    swatch.style.background = playerColors[index].color;
                    name.textContent = playerColors[index].name;
                }
            });
            
            // ÎØ∏Îãà Î≥¥Îìú ÏóÖÎç∞Ïù¥Ìä∏
            updateMiniBoard(palette);
        }

        function updateMiniBoard(palette) {
            const miniBoard = document.getElementById('miniBoard');
            if (!miniBoard) return;
            
            // ÎØ∏Îãà Î≥¥Îìú ÏÉùÏÑ± (7x7 Í∑∏Î¶¨Îìú)
            miniBoard.innerHTML = '';
            
            // 7x7 Î∞îÎëëÌåê Î™®ÏñëÏúºÎ°ú ÏÉâÏÉÅ Î∞∞Ïπò
            const boardLayout = [
                ['golden', 'normal', 'normal', 'normal', 'normal', 'normal', 'corner'],
                ['normal', 'center', 'center', 'center', 'center', 'center', 'normal'],
                ['normal', 'center', 'center', 'center', 'center', 'center', 'normal'],
                ['normal', 'center', 'center', 'center', 'center', 'center', 'normal'],
                ['normal', 'center', 'center', 'center', 'center', 'center', 'normal'],
                ['normal', 'center', 'center', 'center', 'center', 'center', 'normal'],
                ['corner', 'normal', 'normal', 'normal', 'normal', 'normal', 'golden']
            ];
            
            let cellNumber = 1;
            boardLayout.forEach((row, rowIndex) => {
                row.forEach((cellType, colIndex) => {
                    const miniSpace = document.createElement('div');
                    miniSpace.className = 'mini-space';
                    
                    // Ïπ∏ Î≤àÌò∏Î≥Ñ ÏÉâÏÉÅ Îß§Ìïë
                    let color;
                    if ([1, 7, 43, 49].includes(cellNumber)) {
                        // Î™®ÏÑúÎ¶¨ Ïπ∏
                        color = palette.colors.corner;
                    } else if ([4, 22, 28, 46].includes(cellNumber)) {
                        // Ìô©Í∏àÏó¥Ïá† Ïπ∏
                        color = palette.colors.golden;
                    } else if ([2, 3, 5, 6, 8, 15, 29, 36, 14, 21, 35, 42, 44, 45, 47, 48].includes(cellNumber)) {
                        // ÌÄ¥Ï¶à Ïπ∏
                        color = palette.colors.quiz;
                    } else {
                        // Î≥¥Îìú Ï§ëÏïô Ïπ∏ (ÎÇòÎ®∏ÏßÄ)
                        color = palette.colors.center;
                    }
                    
                    miniSpace.style.backgroundColor = color;
                    
                    miniBoard.appendChild(miniSpace);
                    cellNumber++;
                });
            });
        }

        function applySelectedPalette() {
            if (selectedPalette) {
                applyPalette(selectedPalette);
                // ÏÑ§Ï†ï Ï∞ΩÏùÄ Îã´ÏßÄ ÏïäÍ≥† Ïú†ÏßÄ
            }
        }

        function applyPalette(palette) {
            // CSS Î≥ÄÏàò ÏóÖÎç∞Ïù¥Ìä∏
            document.documentElement.style.setProperty('--color-start', palette.colors.golden);
            document.documentElement.style.setProperty('--color-quiz', palette.colors.quiz);
            document.documentElement.style.setProperty('--color-golden', palette.colors.golden);
            document.documentElement.style.setProperty('--color-special', palette.colors.special);
            document.documentElement.style.setProperty('--color-corner', palette.colors.corner);
            document.documentElement.style.setProperty('--color-center', palette.colors.center);
            document.documentElement.style.setProperty('--color-background', palette.colors.background);
            document.documentElement.style.setProperty('--color-normal', palette.colors.normal);
            
            // ÌåîÎ†àÌä∏Î≥Ñ ÌîåÎ†àÏù¥Ïñ¥ ÏÉâÏÉÅ CSS Î≥ÄÏàò ÏÑ§Ï†ï (BoardColorTest.htmlÍ≥º ÎèôÏùº)
            palette.playerColors.forEach((color, index) => {
                document.documentElement.style.setProperty(`--player-color-${index + 1}`, color);
            });
            
            // ÌîåÎ†àÏù¥Ïñ¥ ÏÉâÏÉÅ ÏóÖÎç∞Ïù¥Ìä∏ (ÌåîÎ†àÌä∏Î≥Ñ ÏÉâÏÉÅ ÏÇ¨Ïö©)
            palette.playerColors.forEach((color, index) => {
                if (gameState.players[index]) {
                    gameState.players[index].color = color;
                }
            });
            
            // Î≥¥Îìú Îã§Ïãú Í∑∏Î¶¨Í∏∞
            createBoard();
            updateUI();
            
            // Î≥¥Îìú Ïû¨ÏÉùÏÑ± ÌõÑ Îù†ÏßÄ ÏÉâÏÉÅÍ≥º ÏÜåÏú†Í∂å ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
            setTimeout(() => {
                updateRibbonColors();
                updateLandOwnershipDisplay();
            }, 100);
        }

        // Ï†ÑÏ≤¥ÌôîÎ©¥ ÏÉÅÌÉú Î≥ÄÌôî Í∞êÏßÄ (ESC ÌÇ§ Îì±ÏúºÎ°ú Ìï¥Ï†úÎê† Îïå)
        document.addEventListener('fullscreenchange', () => {
            if (!document.fullscreenElement) {
                document.body.classList.remove('fullscreen-mode');
                document.getElementById('fullscreenIcon').classList.remove('minimize');
                document.getElementById('fullscreenBtn').title = 'Ï†ÑÏ≤¥ÌôîÎ©¥ ÌÜ†Í∏Ä';
            }
        });

        // F11 ÌÇ§ ÏßÄÏõê (ÏÑ†ÌÉùÏÇ¨Ìï≠)
        document.addEventListener('keydown', (event) => {
            if (event.key === 'F11') {
                event.preventDefault();
                toggleFullscreen();
            }
        });

        // Í≤åÏûÑ ÏãúÏûë
        window.onload = function() {
            initGame();
        };
    </script>
</body>
</html>
